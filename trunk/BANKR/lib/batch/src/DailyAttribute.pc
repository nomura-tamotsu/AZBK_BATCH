/*==========================================================================*/
/* Copyright　Information Services International-Dentsu, Ltd.   　          */
/*==========================================================================*/
/*                                                                          */
/* SYSTEM           : BANK・R−CC                                           */
/*                                                                          */
/* PROGRAM NAME     : 顧客属性差分更新処理                                  */
/*                                                                          */
/* MODULE NAME      : DailyAttribute                                        */
/*                                                                          */
/* FUNCTION         : 顧客属性の差分更新処理を行う                          */
/*                                                                          */
/*                                                                          */
/* CALLING MODULE   : Main Module.                                          */
/*                                                                          */
/* CALLED MODULE    : send_err, errhandler, db_connect                      */
/*                                                                          */
/* ENTRY POint      : Main Module.                                          */
/*                                                                          */
/* INPUT            : argv[1]・・・顧客属性差分更新ファイル(ﾌﾙﾊﾟｽ)          */
/*                  : argv[2]・・・処理結果ファイル名(ﾌﾙﾊﾟｽ)                */
/*                                                                          */
/* EXIT             : 正常終了       ・・・NORMAL(0)                        */
/*                    異常終了       ・・・ERROR (9)                        */
/*                                                                          */
/* Mod   yy/mm/dd   Coder           Comment                                 */
/*-----+----------+-------------+-------------------------------------------*/
/* %00 | 14/04/07 | ISID        | First Edition.                            */
/* %01 | 14/05/29 | ISID        | 電話番号桁あふれ対応                      */
/* %02 | 14/06/17 | ISID        | 現行不具合対応                            */
/* %03 | 14/06/20 | ISID        | 電話番号20ｹﾀ対応                          */
/*==========================================================================*/
/*---------------------------------------------------------------------------*/
/* Standard include specification                                            */
/*---------------------------------------------------------------------------*/
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <ctype.h>
#include <errno.h>
#include <sys/stat.h>
#include <sys/types.h>
#include <time.h>

/*---------------------------------------------------------------------------*/
/* User defined include specification                                        */
/*---------------------------------------------------------------------------*/
#include "msg.h"
#include "common.h"
#include "batchcommon.h"
#include "apl_common.h"

EXEC SQL INCLUDE mbproc.h;



/*---------------------------------------------------------------------------*/
/* Internal macro definition                                                 */
/*---------------------------------------------------------------------------*/
typedef struct _RECV_FILE_DATA {
    char    record_id               [  1];      /* 処理区分 */
    char    change_id               [  1];      /* 変更区分 */
    char    branch_id               [  3];      /* 店番 */
    char    cifno                   [ 10];      /* CIFNO */
    char    kojin_no                [ 11];      /* 個人番号 */
    char    personality             [  1];      /* 人格区分 */
    char    setai_no                [ 11];      /* 世帯番号 */
    char    name_kanji              [ 80];      /* 氏名漢字 */
    char    name_kana               [ 80];      /* 氏名カナ */
    char    sex                     [  1];      /* 性別 */
    char    birthday                [  8];      /* 生年月日 */
    char    address_code            [ 11];      /* 住所コード */
    char    post_no                 [ 10];      /* 郵便番号 */
    char    sub_address             [ 60];      /* 補助住所 */
    char    sub_address_kana        [120];      /* 補助住所カナ */
    char    tel_no                  [ 20];      /* 自宅電話番号 */
    char    fax_no                  [ 20];      /* 自宅FAX番号 */
    char    portable_phone          [ 20];      /* 携帯電話番号 */
    char    mail_address            [ 50];      /* MAILアドレス */
    char    job_name_kanji          [ 80];      /* 勤務先名漢字 */
    char    job_name_kana           [ 80];      /* 勤務先名カナ */
    char    job_tel_no              [ 20];      /* 勤務先電話番号 */
    char    renraku_address_code    [ 11];      /* 連絡先住所コード */
    char    renraku_post_no         [ 10];      /* 連絡先郵便番号 */
    char    renraku_sub_adress      [ 60];      /* 連絡先補助住所 */
    char    renraku_sub_adress_kana [120];      /* 連絡先補助住所カナ */
    char    renraku_tel_no          [ 20];      /* 連絡先電話番号 */
    char    renraku_fax_no          [ 20];      /* 連絡先FAX番号 */
    char    nicchu_tel_no           [ 20];      /* 日中連絡先電話番号 */
    char    start_day               [  8];      /* CIF開設日 */
    char    setai_flg               [  1];      /* 世帯主フラグ */
    char    host_tm                 [  1];      /* ホストTM対象区分 */
    char    host_dm                 [  1];      /* ホストDM対象区分 */
    char    flag01                  [  1];      /* 行員区分 */
    char    flag02                  [  1];      /* 郵便不着 */
    char    flag03                  [  1];      /* 会社寮 */
    char    flag04                  [  1];      /* 電話番号間違い */
    char    flag05                  [  1];      /* 移転 */
    char    flag06                  [  1];      /* 本人死亡 */
    char    zandaka                 [ 16];      /* 当行金融資産残高 */
    char    azukari_shisan1         [ 16];      /* 預り資産残高１ */
    char    azukari_shisan2         [ 16];      /* 預り資産残高２ */
    char    azukari_shisan3         [ 16];      /* 預り資産残高３ */
    char    ryudo_zandaka           [ 16];      /* 流動性預金残高 */
    char    teiki_zandaka           [ 16];      /* 定期性預金残高 */
    char    shikumi_zandaka         [ 16];      /* 仕組預金残高 */
    char    gaika_zandaka           [ 16];      /* 外貨預金残高 */
    char    toushin_zandaka         [ 16];      /* 投信残高 */
    char    saiken_zandaka          [ 16];      /* 債券残高 */
    char    risk_zandaka            [ 16];      /* リスク商品残高 */
    char    IB_contract             [  1];      /* IB契約 */
    char    IB_contract_id          [ 16];      /* IB契約者ID */
    char    IB_branch_id            [  3];      /* IB契約申込店番 */
    char    IB_accnt_id             [  4];      /* IB契約代表口座科目 */
    char    IB_kuchi_no             [  3];      /* IB契約代表口座口番号 */
    char    IB_contract_day         [  8];      /* IB契約日 */
    char    IB_cancel_day           [  8];      /* IB契約解除日 */
    char    IB_update_day           [  8];      /* IB契約最終更新日 */
    char    net_contract            [  1];      /* ネット支店契約 */
    char    net_contract_id         [ 16];      /* ネット支店契約者ID */
    char    net_branch_id           [  3];      /* ネット支店契約申込店番 */
    char    net_accnt_id            [  4];      /* ネット支店契約代表口座科目 */
    char    net_kuchi_no            [  3];      /* ネット支店契約代表口座口番号 */
    char    net_contract_day        [  8];      /* ネット支店契約日 */
    char    net_cancel_day          [  8];      /* ネット支店契約解除日 */
    char    net_update_day          [  8];      /* ネット支店契約最終更新日 */
    char    occp_code               [  4];      /* 職業コード */
    char    income                  [ 15];      /* 年収 */
    char    income_year             [  4];      /* 所得年度 */
    char    torikan                 [  1];      /* 取引管理情報 */
    char    operate_name            [ 24];      /* 担当者名 */
    char    card_sign               [  1];      /* カード発行サイン */
    char    adress1                 [ 10];      /* 自宅住所都道府県 */
    char    adress2                 [ 24];      /* 自宅住所市区町村 */
    char    adress3                 [ 36];      /* 自宅住所大字通称 */
    char    adress4                 [ 40];      /* 自宅住所字丁目 */
    char    adress5                 [ 30];      /* 自宅住所番地 */
    char    adress6                 [ 30];      /* 自宅住所気付 */
    char    adress_kana1            [ 10];      /* 自宅住所都道府県カナ */
    char    adress_kana2            [ 24];      /* 自宅住所市区町村カナ */
    char    adress_kana3            [ 36];      /* 自宅住所大字通称カナ */
    char    adress_kana4            [ 40];      /* 自宅住所字丁目カナ */
    char    adress_kana5            [ 30];      /* 自宅住所番地カナ */
    char    adress_kana6            [ 30];      /* 自宅住所気付カナ */
    char    adress                  [170];      /* 自宅住所 */
    char    adress_kana             [175];      /* 自宅住所カナ */
    char    renraku_adress1         [ 10];      /* 連絡先住所都道府県 */
    char    renraku_adress2         [ 24];      /* 連絡先住所市区町村 */
    char    renraku_adress3         [ 36];      /* 連絡先住所大字通称 */
    char    renraku_adress4         [ 40];      /* 連絡先住所字丁目 */
    char    renraku_adress5         [ 30];      /* 連絡先住所番地 */
    char    renraku_adress6         [ 30];      /* 連絡先住所気付 */
    char    renraku_adress_kana1    [ 10];      /* 連絡先住所都道府県カナ */
    char    renraku_adress_kana2    [ 24];      /* 連絡先住所市区町村カナ */
    char    renraku_adress_kana3    [ 36];      /* 連絡先住所大字通称カナ */
    char    renraku_adress_kana4    [ 40];      /* 連絡先住所字丁目カナ */
    char    renraku_adress_kana5    [ 30];      /* 連絡先住所番地カナ */
    char    renraku_adress_kana6    [ 30];      /* 連絡先住所気付カナ */
    char    renraku_adress          [170];      /* 連絡先住所 */
    char    renraku_adress_kana     [175];      /* 連絡先住所カナ */
    char    data_date               [  8];      /* データ基準日 */
	char    tax_free                [  1];      /* マル優 */
    char    yobi                    [133];      /* 予備 */
    char    lf                      [  1];      /* 改行コード */
} RECV_FILE_DATA;

typedef struct _COUNT {
    int  iRecNum;                              /* 処理レコード件数           */
    int  iOkNum ;                              /* 正常終了レコード件数       */
    int  iOkNumW;                              /* (未commit分)               */
    int  iInsNum;                              /* 正常(うち登録レコード件数) */
    int  iInsNumW;                             /* (未commit分)               */
    int  iUpdNum;                              /* 正常(うち登録レコード件数) */
    int  iUpdNumW;                             /* (未commit分)               */
    int  iDelNum;                              /* 正常(うち削除レコード件数) */
    int  iDelNumW;                             /* (未commit分)               */
    int  iNgNum ;                              /* 異常終了レコード件数       */
} COUNT;

/*---------------------------------------------------------------------------*/
/* User Local defined  specification                                         */
/*---------------------------------------------------------------------------*/
#define L_WRITE_END                     1
#define L_WRITE_LOG                     0

/*---------------------------------------------------------------------------*/
/* Global variable specification                                             */
/*---------------------------------------------------------------------------*/
/* 設定ファイル項目（ホスト変数以外）*/
char g_szRecvFile       [AP_CONFIG_LINE];        /* 顧客属性差分更新ファイル */
char g_szLogFile        [AP_CONFIG_LINE];            /* 処理結果ファイル     */

FILE *g_pfRecvFile;
FILE *g_pfLogFile;
char g_szSyoriDate      [  9];                       /* 処理基準日           */
long g_iCommitSU;                                    /* 分割コミット件数保持 */
/*char g_szChange_Name[AP_GYO_CONFIG_MAX];   */          /* 更新者               */
char g_RecordID[2];                                  /* 処理区分             */
char g_ChangeID[2];                                  /* 処理区分             */

char g_szDtlMsg           [AP_C_NOTE_LEN_H];         /* 事象詳細文字列       */

int file_open_flag1  = 0;		/* ファイルオープンフラグ(データファイル用) */
int file_open_flag2  = 0;		/* ファイルオープンフラグ(処理結果ファイル用)  */

/*---------------------------------------------------------------------------*/
/* Host Variable                                                             */
/*---------------------------------------------------------------------------*/
EXEC SQL INCLUDE SQLCA;
EXEC SQL BEGIN DECLARE SECTION;

    char sqlcmd[2048];
    char sqlcmd_del[2048];
    long h_DATA_COUNT;

    /* TD_属性変更情報 */
    varchar                batch_chg_before[144+1];
	short       ind_batch_chg_before;
    varchar                chg_before1[144+1];
	short       ind_chg_before1;
    varchar                chg_before2[144+1];
	short       ind_chg_before2;
    varchar                chg_before3[144+1];
	short       ind_chg_before3;
    varchar                chg_before4[144+1];
	short       ind_chg_before4;

    /* TF_顧客属性 */

    varchar         name_knj[80+1];     /* 氏名漢字             */
    short ind_name_knj;
    varchar         name_kna[80+1];     /* 氏名カナ             */
    short ind_name_kna;
    char sex[2];                                     /* 性別                 */
    short ind_sex;
    char birthday[9];                                /* 生年月日             */
    short ind_birthday;
    char address_code[16];                           /* 住所コード           */
    short ind_address_code;
    char address_no[11];                             /* 郵便番号             */
    short ind_address_no;
    varchar         address_sub[60+1];  /* 補助住所             */
    short ind_address_sub;
    varchar         address_sub_kana[120+1];    /* 補助住所カナ         */
    short ind_address_sub_kana;
    char jitaku_tel[21];                             /* 自宅電話番号         */
    short ind_jitaku_tel;
    char jitaku_fax[21];                             /* 自宅FAX              */
    short ind_jitaku_fax;
    char renraku_address_code[16];                   /* 連絡先住所コード     */
    short ind_renraku_address_code;
    char renraku_address_no[11];                     /* 連絡先郵便番号       */
    short ind_renraku_address_no;
    varchar         renraku_address_sub[60+1];  /* 連絡先補助住所       */
    short ind_renraku_address_sub;
    varchar         renraku_address_sub_kana[120+1];    /* 連絡先補助住所カナ   */
    short ind_renraku_address_sub_kana;
    char renraku_tel[21];                            /* 連絡先電話番号       */
    short ind_renraku_tel;
    char nicchu_tel[21];                             /* 日中連絡先           */
    short ind_nicchu_tel;
    varchar         address[170+1];     /* 自宅住所             */
    short ind_address;
    varchar         address1[10+1];     /* 自宅住所都道府県     */
    short ind_address1;
    varchar         address2[24+1];     /* 自宅住所市区町村     */
    short ind_address2;
    varchar         address3[40+1];     /* 自宅住所字丁目       */
    short ind_address3;
    varchar         address4[36+1];     /* 自宅住所大字通称     */
    short ind_address4;
    varchar         address5[30+1];     /* 自宅住所番地         */
    short ind_address5;
    varchar         address6[30+1];     /* 自宅住所気付         */
    short ind_address6;
    varchar         address_kana[175+1];        /* 自宅住所カナ         */
    short ind_address_kana;
    varchar         address_kana1[20+1];        /* 自宅住所都道府県カナ */
    short ind_address_kana1;
    varchar         address_kana2[48+1];        /* 自宅住所市区町村カナ */
    short ind_address_kana2;
    varchar         address_kana3[72+1];        /* 自宅住所大字通称カナ */
    short ind_address_kana3;
    varchar         address_kana4[80+1];        /* 自宅住所字丁目カナ   */
    short ind_address_kana4;
    varchar         address_kana5[60+1];        /* 自宅住所番地カナ     */
    short ind_address_kana5;
    varchar         address_kana6[60+1];        /* 自宅住所気付カナ     */
    short ind_address_kana6;
    varchar         renraku_address[170+1];     /* 連絡住所             */
    short ind_renraku_address;
    varchar         renraku_address1[10+1];     /* 連絡住所都道府県     */
    short ind_renraku_address1;
    varchar         renraku_address2[24+1];     /* 連絡住所市区町村     */
    short ind_renraku_address2;
    varchar         renraku_address3[36+1];     /* 連絡住所大字通称     */
    short ind_renraku_address3;
    varchar         renraku_address4[40+1];     /* 連絡住所字丁目       */
    short ind_renraku_address4;
    varchar         renraku_address5[30+1];     /* 連絡住所番地         */
    short ind_renraku_address5;
    varchar         renraku_address6[30+1];     /* 連絡住所気付         */
    short ind_renraku_address6;
    varchar         renraku_address_kana[175+1];        /* 連絡住所カナ         */
    short ind_renraku_address_kana;
    varchar         renraku_address_kana1[20+1];        /* 連絡住所都道府県カナ */
    short ind_renraku_address_kana1;
    varchar         renraku_address_kana2[20+1];        /* 連絡住所市区町村カナ */
    short ind_renraku_address_kana2;
    varchar         renraku_address_kana3[20+1];        /* 連絡住所大字通称カナ */
    short ind_renraku_address_kana3;
    varchar         renraku_address_kana4[20+1];        /* 連絡住所字丁目カナ   */
    short ind_renraku_address_kana4;
    varchar         renraku_address_kana5[20+1];        /* 連絡住所番地カナ     */
    short ind_renraku_address_kana5;
    varchar         renraku_address_kana6[20+1];        /* 連絡住所気付カナ     */
    short ind_renraku_address_kana6;

EXEC SQL END DECLARE SECTION;

EXEC SQL INCLUDE TF_KokyakuZokusei.h;					 /* TF_顧客属性          */

char    process_name[43];
char    g_work[1024];

/*---------------------------------------------------------------------------*/
/* Internal function prototype                                               */
/*---------------------------------------------------------------------------*/
/*--------------------------------------------------------------------------*/
/*  #5                       SUBROUTNE DEFINITION                           */
/*--------------------------------------------------------------------------*/
extern int send_err();
extern void errhandler();
extern int db_connect();
void rtrim();
void dump();

static void initialize( int ac, char *av[] );
static int  checkFilles( RECV_FILE_DATA *pData, char *g_szDtlMsg );
static int  checkData( char *pcheck_data, int data_size, char *pmsg,
                       char *pchange_data, char *g_szDtlMsg );
static int  rollback( void );
static int  insertTables( char *g_szDtlMsg );
static int  updateTables( char *g_szDtlMsg );
static int  updateAttribute( char *g_szDtlMsg, int *attribute_flag );

static void strCodeChange ( char *strReturn );
static int  deleteTables( char *g_szDtlMsg );
static int  commit( void );
static void finalize( int rc, int iRecNum, int iOkNum );

static int  putAcctLogFile(int tp,RECV_FILE_DATA *pData,COUNT *dCount,int rc, char *g_szDtlMsg );


/*****************************************************************************/
/* Function Name:                                                            */
/*   int main( int argc, char *argv[] )                                      */
/*                                                                           */
/* Made by:                                                                  */
/* Description:                                                              */
/*      メイン処理                                                           */
/*                                                                           */
/* Arguments:                                                                */
/*   Name          Type/Length  I/O    Content                               */
/* --------------  -----------  ---  -----------------------------------     */
/*    int    argc       引数の数                                             */
/*    char  *argv[]                                                          */
/*                      argv[1]      顧客属性差分更新ファイル(ﾌﾙﾊﾟｽ)         */
/*                      argv[2]      処理結果ファイル名(ﾌﾙﾊﾟｽ)               */
/*                                                                           */
/* Files :                                                                   */
/*    None                                                                   */
/* Tables:                                                                   */
/*    None                                                                   */
/* Return Code:                                                              */
/*                                                                           */
/*****************************************************************************/
/* Process Description:                                                      */
/*                                                                           */
/* Considerations:                                                           */
/*                                                                           */
/* Control Flow:                                                             */
/*                                                                           */
/*****************************************************************************/
int main( int argc, char *argv[] )
{
    int     exit_code = NORMAL;
	int		rc = NORMAL;
	unsigned int RecvSt;


    RECV_FILE_DATA    dData;                         /* データ・レコード     */
    COUNT             dCount; 
	long              iCommitCnt;                  /* 分割コミット用カウンタ */

    int               rc_fin;


	/*-----------------------------*/
    /* Print process start message */
    /*-----------------------------*/

    strcpy( G_STATION, "DailyAttribute" );
	
	memset(process_name,0x00,sizeof(process_name));
    strcpy(process_name,"日次顧客属性差分データ取込処理");

    send_err( m$start_process, NORMAL, process_name, "", "", G_STATION );

	memset( &dCount, 0x00, sizeof( dCount ) );
    iCommitCnt = 0;

    /*-------------------------------------------------------*/
    /* Setup error handler routine                           */
    /*-------------------------------------------------------*/
    EXEC SQL WHENEVER SQLERROR DO errhandler();

    G_POSITION = __LINE__;
    rc = db_connect() ;
    if ( rc != NORMAL ) {
        send_err( m$db_connect, rc, "", "", "", G_STATION );
        rc = ERROR ;
        goto ENDPROC ;
    }


	/* ---------- */
    /* 初期化処理 */
    /* ---------- */
    initialize( argc, argv );



    while( 1 ) {
        memset( g_szDtlMsg, 0x00, sizeof( g_szDtlMsg ) );
		memset( &dData, 0x00, sizeof( dData ) );


        /* ---------------------------------- */
        /* 顧客属性差分更新ファイルからの読込 */
        /* ---------------------------------- */
		RecvSt = (unsigned int)fread( (char *) &dData, sizeof( RECV_FILE_DATA ), 1, g_pfRecvFile );

		/*printf("RecvSt=%d\n",RecvSt);*/

		if (RecvSt != 1) {
			if (feof( g_pfRecvFile ) != 0) {
				rc = NORMAL;
				break;
			}
			else{
				sprintf(g_szDtlMsg,"顧客属性差分更新ファイル(%s)の読込に失敗しました。",g_szRecvFile);
				send_err ( m$file_read, -1, g_szDtlMsg, NULL, NULL, G_STATION);

				rc = ERROR;
				break;
			}
		}
		else{
			rc = NORMAL;
		}

        dCount.iRecNum++;


        /* １万レコード毎にメッセージ出力 */
        if ( (dCount.iRecNum % 10000) == 0 ){
			sprintf ( g_szDtlMsg ,"[%d]レコード処理完了。。。", dCount.iRecNum);
			send_err ( m$message1, 0, g_szDtlMsg, NULL, NULL, G_STATION);
        }

		/*dump(&dData.cifno,sizeof(dData.cifno),"CIFNO");*/

        /* -------------------------------------- */
        /* 顧客属性差分更新ファイルからのチェック */
        /* -------------------------------------- */
        if ( (rc = checkFilles( &dData, g_szDtlMsg )) != NORMAL ){
            goto WriteFile;
        }


        /* -------------- */
        /* 処理区分：新規 */
        /* -------------- */
        if ( atoi(g_RecordID) == AP_C_SYORI_NEW ){
            if ( ( rc = insertTables(g_szDtlMsg) ) != NORMAL ){
                goto WriteFile;
            }
            dCount.iInsNumW++;
            dCount.iOkNumW++;
        }

        /* -------------- */
        /* 処理区分：変更 */
        /* -------------- */
        else if ( atoi(g_RecordID) == AP_C_SYORI_UPDATE ) {
            if ( ( rc = updateTables(g_szDtlMsg) ) != NORMAL ){
                goto WriteFile;
            }
            dCount.iUpdNumW++;
            dCount.iOkNumW++;
        }

        /* -------------- */
        /* 処理区分：削除 */
        /* -------------- */
        else if ( atoi(g_RecordID) == AP_C_SYORI_DELETE ) {
            if ( ( rc = deleteTables(g_szDtlMsg) ) != NORMAL ){
                goto WriteFile;
            }
            dCount.iDelNumW++;
            dCount.iOkNumW++;
        }

        iCommitCnt++;                      /* 顧客属性差分ファイルの処理件数 */


#if 0
		/* 再ランできないのでここでのCOMMITを削除 */
        /* 指定件数に到達したらＤＢのコミット */
        if ( iCommitCnt == g_iCommitSU) {
            dCount.iOkNum = dCount.iOkNum + dCount.iOkNumW;
            dCount.iInsNum = dCount.iInsNum + dCount.iInsNumW;
            dCount.iUpdNum = dCount.iUpdNum + dCount.iUpdNumW;
            dCount.iDelNum = dCount.iDelNum + dCount.iDelNumW;
            iCommitCnt = 0;
            dCount.iOkNumW = 0;
            dCount.iInsNumW = 0;
            dCount.iUpdNumW = 0;
            dCount.iDelNumW = 0;

            if ((rc = commit()) != NORMAL ){
                goto WriteFile;
            }
        }
#endif

WriteFile:
		if ( rc == ERROR ){
            dCount.iOkNumW = 0;
            dCount.iInsNumW = 0;
            dCount.iUpdNumW = 0;
            dCount.iDelNumW = 0;
            rollback();
            iCommitCnt = 0;
			dCount.iNgNum++;
        }
        /* ログ出力 */
        putAcctLogFile(L_WRITE_LOG, &dData, &dCount, rc, g_szDtlMsg );
		if ( rc == ERROR ){
            break;
        }

    } /* while loop end */


    if( rc == NORMAL && dCount.iRecNum == 0 ){

		sprintf ( g_szDtlMsg, "顧客属性差分更新ファイル(%s)は０件ファイルです。", g_szRecvFile );
		send_err (m$message1, NORMAL, g_szDtlMsg, NULL, NULL, G_STATION);
    }

    if ( rc != NORMAL ) {
        rollback();
    }
    else{
        /* ＤＢのコミット */
        if( iCommitCnt > 0 ){
            dCount.iOkNum  = dCount.iOkNum  + iCommitCnt;
            dCount.iInsNum = dCount.iInsNum + dCount.iInsNumW;
            dCount.iUpdNum = dCount.iUpdNum + dCount.iUpdNumW;
            dCount.iDelNum = dCount.iDelNum + dCount.iDelNumW;
            rc = commit();
        }
    }

    /* 改行コードなし時は 正常 処理終了 */
	/*
    if (rc == ERR_LF_NOT_FOUND){
        rc = NORMAL;
    }
	*/


    rc_fin = putAcctLogFile(L_WRITE_END, &dData, &dCount, rc, g_szDtlMsg );
    if (rc == NORMAL){
        rc = rc_fin;
    }


ENDPROC:

	if ( rc == NORMAL ) {
        send_err( m$stop_process, NORMAL, process_name, "", "", G_STATION );
    } else {
        send_err( m$abend_process, ERROR, process_name, "", "", G_STATION );
    }

	finalize( rc, dCount.iRecNum, dCount.iOkNum );

}


/*==========================================================================*/
/* FUNCTION NAME  : initialize                                              */
/*                                                                          */
/* FUNCTION       : 初期化処理                                              */
/*                                                                          */
/*                : 戻り値     無し                                         */
/*                                                                          */
/*==========================================================================*/
static void initialize( int ac, char *av[] )
{
	int exit_code=NORMAL;

    /* コミット件数の取得 */
    g_iCommitSU = 100;


    /* 起動パラメータを使用する */
    if ( ac == 3 ) {
        strcpy(g_szRecvFile,  av[1]); /* 顧客属性差分更新ファイル    */
        strcpy(g_szLogFile,   av[2]); /* 処理結果ファイル            */
    }
    else {
		sprintf (g_szDtlMsg,"顧客属性差分更新ファイル 処理結果ファイル");
		send_err (m$invalid_parameter, ERROR, g_szDtlMsg, NULL, NULL, G_STATION);
		exit_code = ERROR;
		goto initialize_end;
    }



	/* 顧客属性差分更新ファイルのオープン */
	if(( g_pfRecvFile = fopen( g_szRecvFile, "r" )) == NULL ){
		sprintf( g_szDtlMsg, "ファイル%sのオープンに失敗しました。", g_szRecvFile );
		send_err( m$file_open, errno, g_szDtlMsg, NULL, NULL, G_STATION );

		exit_code = ERROR;
		goto initialize_end;
	}
	file_open_flag1 =1;

	/* 処理結果ファイルへのオープ */
	if(( g_pfLogFile = fopen( g_szLogFile, "w" )) == NULL ){
		sprintf( g_szDtlMsg, "ファイル%sのオープンに失敗しました。", g_szLogFile );
		send_err( m$file_open, errno, g_szDtlMsg, NULL, NULL, G_STATION );

		exit_code = ERROR;
		goto initialize_end;
	}
	file_open_flag2 =1;

initialize_end:

	if ( exit_code != NORMAL ) {
		send_err( m$abend_process, ERROR, process_name, "", "", G_STATION );
		exit ( exit_code );    
	}

}


/*****************************************************************************/
/* Function Name:                                                            */
/*   int checkFilles( RECV_FILE_DATA *pData,char *g_szDtlMsg )               */
/*                                                                           */
/* Description:                                                              */
/*   各種チェック                                                            */
/*                                                                           */
/* Arguments:                                                                */
/*   Name          Type/Length  I/O    Content                               */
/* --------------  -----------  ---  -----------------------------------     */
/* RECV_FILE_DATA  *pData        I   顧客属性差分ファイル格納エリア          */
/* g_szDtlMsg       char*         I                                          */
/*                                                                           */
/* Files:                                                                    */
/*   None                                                                    */
/*                                                                           */
/* Tables:                                                                   */
/*   None                                                                    */
/*                                                                           */
/* Return Code:                                                              */
/*        NORMAL: 正常                                                       */
/*        ERROR : データ不正                                                 */
/*                                                                           */
/*****************************************************************************/
/* Process Description:                                                      */
/*                                                                           */
/* Considerations:                                                           */
/*                                                                           */
/* Control Flow:                                                             */
/*                                                                           */
/*****************************************************************************/
static int checkFilles( RECV_FILE_DATA *pData, char *g_szDtlMsg )
{

    int rc = 0;


    memset( g_RecordID, 0x00, sizeof(g_RecordID) );
    memset( g_ChangeID, 0x00, sizeof(g_ChangeID) );

    /* ----------------------------- */
    /* TF_顧客属性のホスト変数初期化 */
    /* ----------------------------- */
    /* 店番 */
    memset( TMKZs_tenban, 0x00, sizeof(TMKZs_tenban) );
    TMKZsi_tenban=ORA_NULL;

    /* CIFNO */
    memset( TMKZs_cifno, 0x00, sizeof(TMKZs_cifno) );
    TMKZsi_cifno=ORA_NULL;
    
    /* 個人企業番号 */
    memset( TMKZs_kojin_kigyo_no, 0x00, sizeof(TMKZs_kojin_kigyo_no) );
    TMKZsi_kojin_kigyo_no=ORA_NULL;
    
    /* 人格区分 */
    memset( TMKZs_jinkaku_kbn, 0x00, sizeof(TMKZs_jinkaku_kbn) );
    TMKZsi_jinkaku_kbn=ORA_NULL;
    
    /* 世帯番号 */
    memset( TMKZs_setai_no, 0x00, sizeof(TMKZs_setai_no) );
    TMKZsi_setai_no=ORA_NULL;
    
    /* 氏名漢字 */
    memset( &TMKZs_name_knj, 0x00, sizeof(TMKZs_name_knj) );
    TMKZs_name_knj.len = 0;
    TMKZsi_name_knj=ORA_NULL;

    /* 氏名漢字更新フラグ */
    memset( TMKZs_name_knj_flg, 0x00, sizeof(TMKZs_name_knj_flg) );
    TMKZsi_name_knj_flg=ORA_NULL;
    
    /* 氏名カナ */
    memset( &TMKZs_name_kna, 0x00, sizeof(TMKZs_name_kna) );
    TMKZs_name_kna.len = 0;
    TMKZsi_name_kna=ORA_NULL;
    
    /* 氏名カナ更新フラグ */
    memset( TMKZs_name_kna_flg, 0x00, sizeof(TMKZs_name_kna_flg) );
    TMKZsi_name_kna_flg=ORA_NULL;
    
    /* 性別 */
    memset( TMKZs_sex, 0x00, sizeof(TMKZs_sex) );
    TMKZsi_sex=ORA_NULL;
    
    /* 性別更新フラグ */
    memset( TMKZs_sex_flg, 0x00, sizeof(TMKZs_sex_flg) );
    TMKZsi_sex_flg=ORA_NULL;
    
    /* 生年月日 */
    memset( TMKZs_birthday, 0x00, sizeof(TMKZs_birthday) );
    TMKZsi_birthday=ORA_NULL;
    
    /* 生年月日更新フラグ */
    memset( TMKZs_birthday_flg, 0x00, sizeof(TMKZs_birthday_flg) );
    TMKZsi_birthday_flg=ORA_NULL;
    
    /* 住所コード */
    memset( TMKZs_zip_cd, 0x00, sizeof(TMKZs_zip_cd) );
    TMKZsi_zip_cd=ORA_NULL;
    
    /* 郵便番号 */
    memset( TMKZs_zip, 0x00, sizeof(TMKZs_zip) );
    TMKZsi_zip=ORA_NULL;
    
    /* 補助住所 */
    memset( &TMKZs_hojo_jyusyo, 0x00, sizeof(TMKZs_hojo_jyusyo) );
    TMKZs_hojo_jyusyo.len = 0;
    TMKZsi_hojo_jyusyo=ORA_NULL;
    
    /* 住所変更フラグ */
    memset( TMKZs_addressflg, 0x00, sizeof(TMKZs_addressflg) );
    TMKZsi_addressflg=ORA_NULL;
    
    /* 補助住所カナ */
    memset( &TMKZs_hojo_jyusyo_kana, 0x00, sizeof(TMKZs_hojo_jyusyo_kana) );
    TMKZs_hojo_jyusyo_kana.len = 0;
    TMKZsi_hojo_jyusyo_kana=ORA_NULL;
    
    /* 住所カナ変更フラグ */
    memset( TMKZs_address_kana_flg, 0x00, sizeof(TMKZs_address_kana_flg) );
    TMKZsi_address_kana_flg=ORA_NULL;
    
    /* 自宅電話番号 */
    memset( TMKZs_jitakutel, 0x00, sizeof(TMKZs_jitakutel) );
    TMKZsi_jitakutel=ORA_NULL;
    
    /* 自宅電話番号更新フラグ */
    memset( TMKZs_jitakutel_flg, 0x00, sizeof(TMKZs_jitakutel_flg) );
    TMKZsi_jitakutel_flg=ORA_NULL;
    
    /* 自宅FAX番号 */
    memset( TMKZs_jitaku_fax, 0x00, sizeof(TMKZs_jitaku_fax) );
    TMKZsi_jitaku_fax=ORA_NULL;
    
    /* 自宅FAX番号更新フラグ */
    memset( TMKZs_jitaku_fax_flg, 0x00, sizeof(TMKZs_jitaku_fax_flg) );
    TMKZsi_jitaku_fax_flg=ORA_NULL;
    
    /* 携帯電話番号 */
    memset( TMKZs_keitai_tel, 0x00, sizeof(TMKZs_keitai_tel) );
    TMKZsi_keitai_tel=ORA_NULL;
    
    /* 携帯電話番号更新フラグ */
    memset( TMKZs_keitai_tel_flg, 0x00, sizeof(TMKZs_keitai_tel_flg) );
    TMKZsi_keitai_tel_flg=ORA_NULL;
    
    /* MAILアドレス */
    memset( &TMKZs_mail, 0x00, sizeof(TMKZs_mail) );
    TMKZs_mail.len = 0;
    TMKZsi_mail=ORA_NULL;
    
    /* MAILアドレス更新フラグ */
    memset( TMKZs_mail_flg, 0x00, sizeof(TMKZs_mail_flg) );
    TMKZsi_mail_flg=ORA_NULL;
    
    /* 勤務先名漢字 */
    memset( &TMKZs_kinmusaki, 0x00, sizeof(TMKZs_kinmusaki) );
    TMKZs_kinmusaki.len = 0;
    TMKZsi_kinmusaki=ORA_NULL;
    
    /* 勤務先名漢字更新フラグ */
    memset( TMKZs_kinmusaki_flg, 0x00, sizeof(TMKZs_kinmusaki_flg) );
    TMKZsi_kinmusaki_flg=ORA_NULL;
    
    /* 勤務先名カナ */
    memset( &TMKZs_kinmusaki_kana, 0x00, sizeof(TMKZs_kinmusaki_kana) );
    TMKZs_kinmusaki_kana.len = 0;
    TMKZsi_kinmusaki_kana=ORA_NULL;

    /* 勤務先名カナ更新フラグ */
    memset( TMKZs_kinmusaki_kana_flg, 0x00, sizeof(TMKZs_kinmusaki_kana_flg) );
    TMKZsi_kinmusaki_kana_flg=ORA_NULL;
    
    /* 勤務先電話番号 */
    memset( TMKZs_kinmusaki_tel, 0x00, sizeof(TMKZs_kinmusaki_tel) );
    TMKZsi_kinmusaki_tel=ORA_NULL;
    
    /* 勤務先電話番号更新フラグ */
    memset( TMKZs_kinmusaki_tel_flg, 0x00, sizeof(TMKZs_kinmusaki_tel_flg) );
    TMKZsi_kinmusaki_tel_flg=ORA_NULL;
    
    /* 連絡先住所コード */
    memset( TMKZs_renrakusaki_zip_cd, 0x00, sizeof(TMKZs_renrakusaki_zip_cd) );
    TMKZsi_renrakusaki_zip_cd=ORA_NULL;
    
    /* 連絡先郵便番号 */
    memset( TMKZs_renrakusaki_zip, 0x00, sizeof(TMKZs_renrakusaki_zip) );
    TMKZsi_renrakusaki_zip=ORA_NULL;
    
    /* 連絡先補助住所 */
    memset( &TMKZs_renrakusaki_hojo_jyusyo, 0x00, sizeof(TMKZs_renrakusaki_hojo_jyusyo) );
    TMKZs_renrakusaki_hojo_jyusyo.len = 0;
    TMKZsi_renrakusaki_hojo_jyusyo=ORA_NULL;
    
    /* 連絡先住所変更フラグ */
    memset( TMKZs_renrakusaki_addressflg, 0x00, sizeof(TMKZs_renrakusaki_addressflg) );
    TMKZsi_renrakusaki_addressflg=ORA_NULL;
    
    /* 連絡先補助住所カナ */
    memset( &TMKZs_renrakusaki_hojo_jyusyo_kana, 0x00, sizeof(TMKZs_renrakusaki_hojo_jyusyo_kana) );
    TMKZs_renrakusaki_hojo_jyusyo_kana.len = 0;
    TMKZsi_renrakusaki_hojo_jyusyo_kana=ORA_NULL;
    
    /* 連絡先住所変更フラグ */
    memset( TMKZs_renrakusaki_address_kana_flg, 0x00, sizeof(TMKZs_renrakusaki_address_kana_flg) );
    TMKZsi_renrakusaki_address_kana_flg=ORA_NULL;
    
    /* 連絡先電話番号 */
    memset( TMKZs_renrakusaki_tel, 0x00, sizeof(TMKZs_renrakusaki_tel) );
    TMKZsi_renrakusaki_tel=ORA_NULL;
    
    /* 連絡先電話番号更新フラグ */
    memset( TMKZs_renrakusaki_tel_flg, 0x00, sizeof(TMKZs_renrakusaki_tel_flg) );
    TMKZsi_renrakusaki_tel_flg=ORA_NULL;
    
    /* 連絡先FAX番号 */
    memset( TMKZs_renrakusaki_fax, 0x00, sizeof(TMKZs_renrakusaki_fax) );
    TMKZsi_renrakusaki_fax=ORA_NULL;
    
    /* 連絡先FAX番号更新フラグ */
    memset( TMKZs_renrakusaki_fax_flg, 0x00, sizeof(TMKZs_renrakusaki_fax_flg) );
    TMKZsi_renrakusaki_fax_flg=ORA_NULL;
    
    /* 日中連絡先電話番号 */
    memset( TMKZs_nicchu_tel, 0x00, sizeof(TMKZs_nicchu_tel) );
    TMKZsi_nicchu_tel=ORA_NULL;
    
    /* 日中連絡先電話番号更新フラグ */
    memset( TMKZs_nicchu_tel_flg, 0x00, sizeof(TMKZs_nicchu_tel_flg) );
    TMKZsi_nicchu_tel_flg=ORA_NULL;
    
    /* 行員区分 */
    memset( TMKZs_kouin_kbn, 0x00, sizeof(TMKZs_kouin_kbn) );
    TMKZsi_kouin_kbn=ORA_NULL;
    
    /* 郵便不着 */
    memset( TMKZs_futyaku, 0x00, sizeof(TMKZs_futyaku) );
    TMKZsi_futyaku=ORA_NULL;
    
    /* 会社寮 */
    memset( TMKZs_kaisya_ryo, 0x00, sizeof(TMKZs_kaisya_ryo) );
    TMKZsi_kaisya_ryo=ORA_NULL;
    
    /* 電話番号間違い */
    memset( TMKZs_denwa_matigai, 0x00, sizeof(TMKZs_denwa_matigai) );
    TMKZsi_denwa_matigai=ORA_NULL;
    
    /* 移転 */
    memset( TMKZs_iten, 0x00, sizeof(TMKZs_iten) );
    TMKZsi_iten=ORA_NULL;
    
    /* 本人死亡 */
    memset( TMKZs_honnin_sibo, 0x00, sizeof(TMKZs_honnin_sibo) );
    TMKZsi_honnin_sibo=ORA_NULL;
    
    /* ホストTM対象区分 */
    memset( TMKZs_host_tm, 0x00, sizeof(TMKZs_host_tm) );
    TMKZsi_host_tm=ORA_NULL;
    
    /* ホストDM対象区分 */
    memset( TMKZs_host_dm, 0x00, sizeof(TMKZs_host_dm) );
    TMKZsi_host_dm=ORA_NULL;

    /* 取引開始日 */
    memset( TMKZs_deal_day, 0x00, sizeof(TMKZs_deal_day) );
    TMKZsi_deal_day=ORA_NULL;

    /* 世帯主フラグ */
    memset( TMKZs_setai_flg, 0x00, sizeof(TMKZs_setai_flg) );
    TMKZsi_setai_flg=ORA_NULL;

    /* 当行金融資産残高 */
    memset( TMKZs_zandaka, 0x00, sizeof(TMKZs_zandaka) );
    TMKZsi_zandaka=ORA_NULL;

    /* 預り資産残高１ */
    memset( TMKZs_azukari_shisan1, 0x00, sizeof(TMKZs_azukari_shisan1) );
    TMKZsi_azukari_shisan1=ORA_NULL;

    /* 預り資産残高２ */
    memset( TMKZs_azukari_shisan2, 0x00, sizeof(TMKZs_azukari_shisan2) );
    TMKZsi_azukari_shisan2=ORA_NULL;

    /* 預り資産残高３ */
    memset( TMKZs_azukari_shisan3, 0x00, sizeof(TMKZs_azukari_shisan3) );
    TMKZsi_azukari_shisan3=ORA_NULL;

    /* 流動性預金残高 */
    memset( TMKZs_ryudo_zandaka, 0x00, sizeof(TMKZs_ryudo_zandaka) );
    TMKZsi_ryudo_zandaka=ORA_NULL;

    /* 定期性預金残高 */
    memset( TMKZs_teiki_zandaka, 0x00, sizeof(TMKZs_teiki_zandaka) );
    TMKZsi_teiki_zandaka=ORA_NULL;

    /* 仕組預金残高 */
    memset( TMKZs_shikumi_zandaka, 0x00, sizeof(TMKZs_shikumi_zandaka) );
    TMKZsi_shikumi_zandaka=ORA_NULL;

    /* 外貨預金残高 */
    memset( TMKZs_gaika_zandaka, 0x00, sizeof(TMKZs_gaika_zandaka) );
    TMKZsi_gaika_zandaka=ORA_NULL;

    /* 投信残高 */
    memset( TMKZs_toushin_zandaka, 0x00, sizeof(TMKZs_toushin_zandaka) );
    TMKZsi_toushin_zandaka=ORA_NULL;

    /* 債券残高 */
    memset( TMKZs_saiken_zandaka, 0x00, sizeof(TMKZs_saiken_zandaka) );
    TMKZsi_saiken_zandaka=ORA_NULL;

    /* リスク商品残高 */
    memset( TMKZs_risk_zandaka, 0x00, sizeof(TMKZs_risk_zandaka) );
    TMKZsi_risk_zandaka=ORA_NULL;

    /* IB契約 */
    memset( TMKZs_IB_contract, 0x00, sizeof(TMKZs_IB_contract) );
    TMKZsi_IB_contract=ORA_NULL;

    /* IB契約者ID */
    memset( TMKZs_IB_contract_id, 0x00, sizeof(TMKZs_IB_contract_id) );
    TMKZsi_IB_contract_id=ORA_NULL;

    /* IB契約申込店番 */
    memset( TMKZs_IB_branch_id, 0x00, sizeof(TMKZs_IB_branch_id) );
    TMKZsi_IB_branch_id=ORA_NULL;

    /* IB契約代表口座科目 */
    memset( TMKZs_IB_accnt_id, 0x00, sizeof(TMKZs_IB_accnt_id) );
    TMKZsi_IB_accnt_id=ORA_NULL;

    /* IB契約代表口座口番号 */
    memset( TMKZs_IB_kuchi_no, 0x00, sizeof(TMKZs_IB_kuchi_no) );
    TMKZsi_IB_kuchi_no=ORA_NULL;

    /* IB契約日 */
    memset( TMKZs_IB_contract_day, 0x00, sizeof(TMKZs_IB_contract_day) );
    TMKZsi_IB_contract_day=ORA_NULL;

    /* IB契約解除日 */
    memset( TMKZs_IB_cancel_day, 0x00, sizeof(TMKZs_IB_cancel_day) );
    TMKZsi_IB_cancel_day=ORA_NULL;

    /* IB契約最終更新日 */
    memset( TMKZs_IB_update_day, 0x00, sizeof(TMKZs_IB_update_day) );
    TMKZsi_IB_update_day=ORA_NULL;

    /* ネット支店契約 */
    memset( TMKZs_net_contract, 0x00, sizeof(TMKZs_net_contract) );
    TMKZsi_net_contract=ORA_NULL;

    /* ネット支店契約者ID */
    memset( TMKZs_net_contract_id, 0x00, sizeof(TMKZs_net_contract_id) );
    TMKZsi_net_contract_id=ORA_NULL;

    /* ネット支店契約申込店番 */
    memset( TMKZs_net_branch_id, 0x00, sizeof(TMKZs_net_branch_id) );
    TMKZsi_net_branch_id=ORA_NULL;

    /* ネット支店契約代表口座科目 */
    memset( TMKZs_net_accnt_id, 0x00, sizeof(TMKZs_net_accnt_id) );
    TMKZsi_net_accnt_id=ORA_NULL;

    /* ネット支店契約代表口座口番号 */
    memset( TMKZs_net_kuchi_no, 0x00, sizeof(TMKZs_net_kuchi_no) );
    TMKZsi_net_kuchi_no=ORA_NULL;

    /* ネット支店契約日 */
    memset( TMKZs_net_contract_day, 0x00, sizeof(TMKZs_net_contract_day) );
    TMKZsi_net_contract_day=ORA_NULL;

    /* ネット支店契約解除日 */
    memset( TMKZs_net_cancel_day, 0x00, sizeof(TMKZs_net_cancel_day) );
    TMKZsi_net_cancel_day=ORA_NULL;

    /* ネット支店契約最終更新日 */
    memset( TMKZs_net_update_day, 0x00, sizeof(TMKZs_net_update_day) );
    TMKZsi_net_update_day=ORA_NULL;

    /* 職業コード */
    memset( TMKZs_occp_code, 0x00, sizeof(TMKZs_occp_code) );
    TMKZsi_occp_code=ORA_NULL;

    /* 年収 */
    memset( TMKZs_income, 0x00, sizeof(TMKZs_income) );
    TMKZsi_income=ORA_NULL;

    /* 所得年度 */
    memset( TMKZs_income_year, 0x00, sizeof(TMKZs_income_year) );
    TMKZsi_income_year=ORA_NULL;

    /* 取引管理情報 */
    memset( TMKZs_torikan, 0x00, sizeof(TMKZs_torikan) );
    TMKZsi_torikan=ORA_NULL;

    /* 担当者名 */
    memset( TMKZs_operate_name, 0x00, sizeof(TMKZs_operate_name) );
    TMKZsi_operate_name=ORA_NULL;

    /* カード発行サイン */
    memset( TMKZs_card_sign, 0x00, sizeof(TMKZs_card_sign) );
    TMKZsi_card_sign=ORA_NULL;

    /* 自宅住所都道府県 */
    memset( &TMKZs_adress1, 0x00, sizeof(TMKZs_adress1) );
    TMKZs_adress1.len=0;
    TMKZsi_adress1=ORA_NULL;

    /* 自宅住所市区町村 */
    memset( &TMKZs_adress2, 0x00, sizeof(TMKZs_adress2) );
    TMKZs_adress2.len=0;
    TMKZsi_adress2=ORA_NULL;

    /* 自宅住所大字通称 */
    memset( &TMKZs_adress3, 0x00, sizeof(TMKZs_adress3) );
    TMKZs_adress3.len=0;
    TMKZsi_adress3=ORA_NULL;

    /* 自宅住所字丁目 */
    memset( &TMKZs_adress4, 0x00, sizeof(TMKZs_adress4) );
    TMKZs_adress4.len=0;
    TMKZsi_adress4=ORA_NULL;

    /* 自宅住所番地 */
    memset( &TMKZs_adress5, 0x00, sizeof(TMKZs_adress5) );
    TMKZs_adress5.len=0;
    TMKZsi_adress5=ORA_NULL;

    /* 自宅住所気付 */
    memset( &TMKZs_adress6, 0x00, sizeof(TMKZs_adress6) );
    TMKZs_adress6.len=0;
    TMKZsi_adress6=ORA_NULL;

    /* 自宅住所都道府県カナ */
    memset( &TMKZs_adress_kana1, 0x00, sizeof(TMKZs_adress_kana1) );
    TMKZs_adress_kana1.len=0;
    TMKZsi_adress_kana1=ORA_NULL;

    /* 自宅住所市区町村カナ */
    memset( &TMKZs_adress_kana2, 0x00, sizeof(TMKZs_adress_kana2) );
    TMKZs_adress_kana2.len=0;
    TMKZsi_adress_kana2=ORA_NULL;

    /* 自宅住所大字通称カナ */
    memset( &TMKZs_adress_kana3, 0x00, sizeof(TMKZs_adress_kana3) );
    TMKZs_adress_kana3.len=0;
    TMKZsi_adress_kana3=ORA_NULL;

    /* 自宅住所字丁目カナ */
    memset( &TMKZs_adress_kana4, 0x00, sizeof(TMKZs_adress_kana4) );
    TMKZs_adress_kana4.len=0;
    TMKZsi_adress_kana4=ORA_NULL;

    /* 自宅住所番地カナ */
    memset( &TMKZs_adress_kana5, 0x00, sizeof(TMKZs_adress_kana5) );
    TMKZs_adress_kana5.len=0;
    TMKZsi_adress_kana5=ORA_NULL;

    /* 自宅住所気付カナ */
    memset( &TMKZs_adress_kana6, 0x00, sizeof(TMKZs_adress_kana6) );
    TMKZs_adress_kana6.len=0;
    TMKZsi_adress_kana6=ORA_NULL;

    /* 自宅住所 */
    memset( &TMKZs_adress, 0x00, sizeof(TMKZs_adress) );
    TMKZs_adress.len = 0;
    TMKZsi_adress=ORA_NULL;

    /* 自宅住所カナ */
    memset( &TMKZs_adress_kana, 0x00, sizeof(TMKZs_adress_kana) );
    TMKZs_adress_kana.len = 0;
    TMKZsi_adress_kana=ORA_NULL;

    /* 連絡先住所都道府県 */
    memset( &TMKZs_renrakusaki_adress1, 0x00, sizeof(TMKZs_renrakusaki_adress1) );
    TMKZs_renrakusaki_adress1.len=0;
    TMKZsi_renrakusaki_adress1=ORA_NULL;

    /* 連絡先住所市区町村 */
    memset( &TMKZs_renrakusaki_adress2, 0x00, sizeof(TMKZs_renrakusaki_adress2) );
    TMKZs_renrakusaki_adress2.len=0;
    TMKZsi_renrakusaki_adress2=ORA_NULL;

    /* 連絡先住所大字通称 */
    memset( &TMKZs_renrakusaki_adress3, 0x00, sizeof(TMKZs_renrakusaki_adress3) );
    TMKZs_renrakusaki_adress3.len=0;
    TMKZsi_renrakusaki_adress3=ORA_NULL;

    /* 連絡先住所字丁目 */
    memset( &TMKZs_renrakusaki_adress4, 0x00, sizeof(TMKZs_renrakusaki_adress4) );
    TMKZs_renrakusaki_adress4.len=0;
    TMKZsi_renrakusaki_adress4=ORA_NULL;

    /* 連絡先住所番地 */
    memset( &TMKZs_renrakusaki_adress5, 0x00, sizeof(TMKZs_renrakusaki_adress5) );
    TMKZs_renrakusaki_adress5.len=0;
    TMKZsi_renrakusaki_adress5=ORA_NULL;

    /* 連絡先住所気付 */
    memset( &TMKZs_renrakusaki_adress6, 0x00, sizeof(TMKZs_renrakusaki_adress6) );
    TMKZs_renrakusaki_adress6.len=0;
    TMKZsi_renrakusaki_adress6=ORA_NULL;

    /* 連絡先住所都道府県カナ */
    memset( &TMKZs_renrakusaki_adress_kana1, 0x00, sizeof(TMKZs_renrakusaki_adress_kana1) );
    TMKZs_renrakusaki_adress_kana1.len=0;
    TMKZsi_renrakusaki_adress_kana1=ORA_NULL;

    /* 連絡先住所市区町村カナ */
    memset( &TMKZs_renrakusaki_adress_kana2, 0x00, sizeof(TMKZs_renrakusaki_adress_kana2) );
    TMKZs_renrakusaki_adress_kana2.len=0;
    TMKZsi_renrakusaki_adress_kana2=ORA_NULL;

    /* 連絡先住所大字通称カナ */
    memset( &TMKZs_renrakusaki_adress_kana3, 0x00, sizeof(TMKZs_renrakusaki_adress_kana3) );
    TMKZs_renrakusaki_adress_kana3.len=0;
    TMKZsi_renrakusaki_adress_kana3=ORA_NULL;

    /* 連絡先住所字丁目カナ */
    memset( &TMKZs_renrakusaki_adress_kana4, 0x00, sizeof(TMKZs_renrakusaki_adress_kana4) );
    TMKZs_renrakusaki_adress_kana4.len=0;
    TMKZsi_renrakusaki_adress_kana4=ORA_NULL;

    /* 連絡先住所番地カナ */
    memset( &TMKZs_renrakusaki_adress_kana5, 0x00, sizeof(TMKZs_renrakusaki_adress_kana5) );
    TMKZs_renrakusaki_adress_kana5.len=0;
    TMKZsi_renrakusaki_adress_kana5=ORA_NULL;

    /* 連絡先住所気付カナ */
    memset( &TMKZs_renrakusaki_adress_kana6, 0x00, sizeof(TMKZs_renrakusaki_adress_kana6) );
    TMKZs_renrakusaki_adress_kana6.len=0;
    TMKZsi_renrakusaki_adress_kana6=ORA_NULL;

    /* 連絡先住所 */
    memset( &TMKZs_renrakusaki_adress, 0x00, sizeof(TMKZs_renrakusaki_adress) );
    TMKZs_renrakusaki_adress.len = 0;
    TMKZsi_renrakusaki_adress=ORA_NULL;

    /* 連絡先住所カナ */
    memset( &TMKZs_renrakusaki_adress_kana, 0x00, sizeof(TMKZs_renrakusaki_adress_kana) );
    TMKZs_renrakusaki_adress_kana.len = 0;
    TMKZsi_renrakusaki_adress_kana=ORA_NULL;

    /* データ基準日 */
    memset( TMKZs_data_date, 0x00, sizeof(TMKZs_data_date) );
    TMKZsi_data_date=ORA_NULL;

	/* マル優 */
    memset( TMKZs_tax_free, 0x00, sizeof(TMKZs_tax_free) );
    TMKZsi_tax_free=ORA_NULL;

    /* ---------------------------------- */
    /* 顧客属性差分更新ファイルのチェック */
    /* ホスト変数へのデータセット         */
    /* ---------------------------------- */


    /* 改行コード */
    if( pData->lf[0] != 0x0a ) {
        strcpy( g_szDtlMsg,
                "顧客属性差分ファイルに改行コードの設定がありません。");

        send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
        return(ERROR);
    }

    /* 処理区分 */
    if( pData->record_id[0] == 0x00 || pData->record_id[0] == 0x20 ) {
        strcpy( g_szDtlMsg, "処理区分の設定がありません。");
        send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
        return(ERROR);
    }
    else {
        memcpy( g_RecordID, pData->record_id, sizeof(pData->record_id) );
        if ( atoi(g_RecordID) < AP_C_SYORI_NEW ||
             atoi(g_RecordID) > AP_C_SYORI_DELETE ){
            sprintf( g_szDtlMsg,
                     "顧客属性差分ファイルの処理区分(%s)が異常です。",
                     g_RecordID);
            send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
            return(ERROR);
        }
    }

    /* 変更区分 */
    if( atoi(g_RecordID) == AP_C_SYORI_UPDATE ){
        if( pData->change_id[0] == 0x00 || pData->change_id[0] == 0x20 ) {
            strcpy( g_szDtlMsg, "変更区分の設定がありません。");
            send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
            return(ERROR);
        }
        else {
            memcpy( g_ChangeID, pData->change_id, sizeof(pData->change_id) );
            if ( atoi(g_ChangeID) != AP_C_SYORI_NORMAL ){
                sprintf( g_szDtlMsg,
                         "顧客属性差分ファイルの変更区分(%s)が異常です。",
                         g_ChangeID);
                send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
                return(ERROR);
            }
        }
    }



    /* 店番 */
    rc = checkData(pData->branch_id, sizeof(pData->branch_id),
                   "店番", TMKZs_tenban, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_tenban=ORA_NOT_NULL;
    }



    /* CIFNO */
    rc = checkData(pData->cifno, sizeof(pData->cifno),
                   "CIFNO", TMKZs_cifno, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_cifno=ORA_NOT_NULL;
    }

    /* 個人番号 */
    rc = checkData(pData->kojin_no, sizeof(pData->kojin_no),
                   "個人番号", TMKZs_kojin_kigyo_no, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_kojin_kigyo_no=ORA_NOT_NULL;
    }

    /* 人格区分 */
    rc = checkData(pData->personality, sizeof(pData->personality),
                   "人格区分", TMKZs_jinkaku_kbn, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_jinkaku_kbn=ORA_NOT_NULL;
    }

    /* 世帯番号 */
    rc = checkData(pData->setai_no, sizeof(pData->setai_no),
                   "世帯番号", TMKZs_setai_no, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_setai_no=ORA_NOT_NULL;
    }


    /* 顧客属性テーブル確認 */
    h_DATA_COUNT = 0;                            /* 顧客属性カウント         */

	G_POSITION = __LINE__;
    EXEC SQL SELECT COUNT(*) INTO :h_DATA_COUNT FROM TF_顧客属性
        WHERE
             CIFNO = :TMKZs_cifno;
/*
	printf("TMKZs_cifno=[%s]\n",TMKZs_cifno);
	printf("h_DATA_COUNT=%d\n",h_DATA_COUNT);
*/


    if (sqlca.sqlcode != 0 && sqlca.sqlcode != ORA_NOF){
        sprintf( g_szDtlMsg,
                 "[店番=%s CIFNO=%s]TF_顧客属性テーブルの検索に失敗しました。(sqlca.sqlcode=%d)",
                  TMKZs_tenban, TMKZs_cifno, sqlca.sqlcode );
		send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
		send_err ( m$sql_statment, sqlca.sqlcode, "SELECT COUNT(*) TF_顧客属性", NULL, NULL, G_STATION);
        return(ERROR);
    }


    if ( (atoi(g_RecordID) == AP_C_SYORI_NEW && h_DATA_COUNT > 0) ){
        sprintf( g_szDtlMsg,
                 "[店番=%s CIFNO=%s 処理区分=%s 顧客属性COUNT=%d]既にTF_顧客属性テーブルに存在するデータです。",
                  TMKZs_tenban, TMKZs_cifno, g_RecordID, h_DATA_COUNT );
        send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
        return(ERROR);
    }
    if ( (atoi(g_RecordID) == AP_C_SYORI_UPDATE && h_DATA_COUNT == 0) ||
         (atoi(g_RecordID) == AP_C_SYORI_DELETE && h_DATA_COUNT == 0) ){
        sprintf( g_szDtlMsg,
                 "[店番=%s CIFNO=%s 処理区分=%s 顧客属性COUNT=%d]TF_顧客属性テーブルに存在しないデータです。",
                  TMKZs_tenban, TMKZs_cifno, g_RecordID, h_DATA_COUNT );
        send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
        return(ERROR);
    }

    /* 処理区分＝削除はここまで */
    if ( atoi(g_RecordID) == AP_C_SYORI_DELETE ){
        return(NORMAL);
    }

    /* 氏名漢字 値なし許可 */
    if( pData->name_kanji[0] != 0x00 && pData->name_kanji[0] != 0x20 ) {
        memcpy( TMKZs_name_knj.arr, pData->name_kanji, sizeof(pData->name_kanji) );
        rtrim( TMKZs_name_knj.arr );
        TMKZs_name_knj.len = (unsigned int)strlen(TMKZs_name_knj.arr);
        TMKZsi_name_knj=ORA_NOT_NULL;
    }

    /* 氏名カナ */
    rc = checkData(pData->name_kana, sizeof(pData->name_kana),
                   "氏名カナ", TMKZs_name_kna.arr, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_name_kna=ORA_NOT_NULL;

        TMKZs_name_kna.len = (unsigned int)strlen(TMKZs_name_kna.arr);
    }

    /* 性別 */
    rc = checkData(pData->sex, sizeof(pData->sex), "性別", TMKZs_sex, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_sex=ORA_NOT_NULL;
    }

    /* 生年月日 値なし許可 */
    if( pData->birthday[0] != 0x00 && pData->birthday[0] != 0x20 ) {
        memcpy( TMKZs_birthday, pData->birthday, sizeof(pData->birthday) );
        rtrim( TMKZs_birthday );
        TMKZsi_birthday=ORA_NOT_NULL;
    }

    /* 住所コード */
    rc = checkData(pData->address_code, sizeof(pData->address_code),
                   "住所コード", TMKZs_zip_cd, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_zip_cd=ORA_NOT_NULL;
    }

    /* 郵便番号 値なし許可 */
    if( pData->post_no[0] != 0x00 && pData->post_no[0] != 0x20 ) {
        memcpy( TMKZs_zip, pData->post_no, sizeof(pData->post_no) );
        rtrim( TMKZs_zip );
        TMKZsi_zip=ORA_NOT_NULL;
    }

    /* 補助住所 値なし許可 */
    if( pData->sub_address[0] != 0x00 && pData->sub_address[0] != 0x20 ) {
        memcpy( TMKZs_hojo_jyusyo.arr, pData->sub_address, sizeof(pData->sub_address) );
        rtrim( TMKZs_hojo_jyusyo.arr );
        TMKZs_hojo_jyusyo.len = (unsigned int)strlen(TMKZs_hojo_jyusyo.arr);
        TMKZsi_hojo_jyusyo=ORA_NOT_NULL;
    }

    /* 補助住所カナ 値なし許可 */
    if( pData->sub_address_kana[0] != 0x00 && pData->sub_address_kana[0] != 0x20 ) {
        memcpy( TMKZs_hojo_jyusyo_kana.arr, pData->sub_address_kana, sizeof(pData->sub_address_kana) );
        rtrim( TMKZs_hojo_jyusyo_kana.arr );
        TMKZsi_hojo_jyusyo_kana=ORA_NOT_NULL;

        TMKZs_hojo_jyusyo_kana.len = (unsigned int)strlen(TMKZs_hojo_jyusyo_kana.arr);
    }

    /* 自宅電話番号 値なし許可 */
    if( pData->tel_no[0] != 0x00 && pData->tel_no[0] != 0x20 ) {
        memcpy( TMKZs_jitakutel, pData->tel_no, sizeof(pData->tel_no) );
        rtrim( TMKZs_jitakutel );
        TMKZsi_jitakutel=ORA_NOT_NULL;
		/* %03 Add */
		if ( strlen(TMKZs_jitakutel) > 15 ) {
			sprintf( g_szDtlMsg,"自宅電話番号桁あふれ カットしました[CIFNO=%s] 番号=[%s]",
						TMKZs_cifno,TMKZs_jitakutel );
			send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			TMKZs_jitakutel[15] = 0x0;
			
		}
    }

    /* 自宅FAX番号 値なし許可 */
    if( pData->fax_no[0] != 0x00 && pData->fax_no[0] != 0x20 ) {
        memcpy( TMKZs_jitaku_fax, pData->fax_no, sizeof(pData->fax_no) );
        rtrim( TMKZs_jitaku_fax );
        TMKZsi_jitaku_fax=ORA_NOT_NULL;
		/* %03 Add */
		if ( strlen(TMKZs_jitaku_fax) > 15 ) {
			sprintf( g_szDtlMsg,"自宅FAX番号桁あふれ カットしました[CIFNO=%s] 番号=[%s]",
						TMKZs_cifno,TMKZs_jitaku_fax );
			send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			TMKZs_jitaku_fax[15] = 0x0;
			
		}
    }

    /* 携帯電話番号 値なし許可 */
    if( pData->portable_phone[0] != 0x00 && pData->portable_phone[0] != 0x20 ) {
        memcpy( TMKZs_keitai_tel, pData->portable_phone, sizeof(pData->portable_phone) );
        rtrim( TMKZs_keitai_tel );
        TMKZsi_keitai_tel=ORA_NOT_NULL;
		/* %03 Add */
		if ( strlen(TMKZs_keitai_tel) > 15 ) {
			sprintf( g_szDtlMsg,"携帯電話番号桁あふれ カットしました[CIFNO=%s] 番号=[%s]",
						TMKZs_cifno,TMKZs_keitai_tel );
			send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			TMKZs_keitai_tel[15] = 0x0;
			
		}
    }

    /* MAILアドレス 値なし許可 */
    if( pData->mail_address[0] != 0x00 && pData->mail_address[0] != 0x20 ) {
        memcpy( TMKZs_mail.arr, pData->mail_address, sizeof(pData->mail_address) );
        rtrim( TMKZs_mail.arr );
        TMKZs_mail.len = (unsigned int)strlen(TMKZs_mail.arr);
        TMKZsi_mail=ORA_NOT_NULL;
    }

    /* 勤務先名漢字 値なし許可 */
    if( pData->job_name_kanji[0] != 0x00 && pData->job_name_kanji[0] != 0x20 ) {
        memcpy( TMKZs_kinmusaki.arr, pData->job_name_kanji, sizeof(pData->job_name_kanji) );
        rtrim( TMKZs_kinmusaki.arr );
        TMKZs_kinmusaki.len = (unsigned int)strlen(TMKZs_kinmusaki.arr);
        TMKZsi_kinmusaki=ORA_NOT_NULL;
    }

    /* 勤務先名カナ 値なし許可 */
    if( pData->job_name_kana[0] != 0x00 && pData->job_name_kana[0] != 0x20 ) {
        memcpy( TMKZs_kinmusaki_kana.arr, pData->job_name_kana, sizeof(pData->job_name_kana) );
        rtrim( TMKZs_kinmusaki_kana.arr );
        TMKZsi_kinmusaki_kana=ORA_NOT_NULL;

		TMKZs_kinmusaki_kana.len = (unsigned int)strlen(TMKZs_kinmusaki_kana.arr);
    }

    /* 勤務先電話番号 値なし許可 */
    if( pData->job_tel_no[0] != 0x00 && pData->job_tel_no[0] != 0x20 ) {
        memcpy( TMKZs_kinmusaki_tel, pData->job_tel_no, sizeof(pData->job_tel_no) );
        rtrim( TMKZs_kinmusaki_tel );
        TMKZsi_kinmusaki_tel=ORA_NOT_NULL;
		/* %03 Add */
		if ( strlen(TMKZs_kinmusaki_tel) > 15 ) {
			sprintf( g_szDtlMsg,"勤務先電話番号桁あふれ カットしました[CIFNO=%s] 番号=[%s]",
						TMKZs_cifno,TMKZs_kinmusaki_tel );
			send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			TMKZs_kinmusaki_tel[15] = 0x0;
			
		}
    }

    /* 連絡先住所コード 値なし許可*/
    if( pData->renraku_address_code[0] != 0x00 && pData->renraku_address_code[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_zip_cd, pData->renraku_address_code, sizeof(pData->renraku_address_code) );
        rtrim( TMKZs_renrakusaki_zip_cd );
        TMKZsi_renrakusaki_zip_cd=ORA_NOT_NULL;
    }

    /* 連絡先郵便番号 値なし許可 */
    if( pData->renraku_post_no[0] != 0x00 && pData->renraku_post_no[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_zip, pData->renraku_post_no, sizeof(pData->renraku_post_no) );
        rtrim( TMKZs_renrakusaki_zip );
        TMKZsi_renrakusaki_zip=ORA_NOT_NULL;
    }

    /* 連絡先補助住所 値なし許可 */
    if( pData->renraku_sub_adress[0] != 0x00 && pData->renraku_sub_adress[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_hojo_jyusyo.arr, pData->renraku_sub_adress, sizeof(pData->renraku_sub_adress) );
        rtrim( TMKZs_renrakusaki_hojo_jyusyo.arr );
        TMKZs_renrakusaki_hojo_jyusyo.len = (unsigned int)strlen(TMKZs_renrakusaki_hojo_jyusyo.arr);
        TMKZsi_renrakusaki_hojo_jyusyo=ORA_NOT_NULL;
    }

    /* 連絡先補助住所カナ 値なし許可 */
    if( pData->renraku_sub_adress_kana[0] != 0x00 && pData->renraku_sub_adress_kana[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_hojo_jyusyo_kana.arr, pData->renraku_sub_adress_kana, sizeof(pData->renraku_sub_adress_kana) );
        rtrim( TMKZs_renrakusaki_hojo_jyusyo_kana.arr );
        TMKZsi_renrakusaki_hojo_jyusyo_kana=ORA_NOT_NULL;

        TMKZs_renrakusaki_hojo_jyusyo_kana.len = (unsigned int)strlen(TMKZs_renrakusaki_hojo_jyusyo_kana.arr);
    }

    /* 連絡先電話番号 値なし許可 */
    if( pData->renraku_tel_no[0] != 0x00 && pData->renraku_tel_no[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_tel, pData->renraku_tel_no, sizeof(pData->renraku_tel_no) );
        rtrim( TMKZs_renrakusaki_tel );
        TMKZsi_renrakusaki_tel=ORA_NOT_NULL;
		/* %03 Add */
		if ( strlen(TMKZs_renrakusaki_tel) > 15 ) {
			sprintf( g_szDtlMsg,"連絡先電話番号桁あふれ カットしました[CIFNO=%s] 番号=[%s]",
						TMKZs_cifno,TMKZs_renrakusaki_tel );
			send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			TMKZs_renrakusaki_tel[15] = 0x0;
		}
    }

    /* 連絡先FAX番号 値なし許可 */
    if( pData->renraku_fax_no[0] != 0x00 && pData->renraku_fax_no[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_fax, pData->renraku_fax_no, sizeof(pData->renraku_fax_no) );
        rtrim( TMKZs_renrakusaki_fax );
        TMKZsi_renrakusaki_fax=ORA_NOT_NULL;
		/* %03 Add */
		if ( strlen(TMKZs_renrakusaki_fax) > 15 ) {
			sprintf( g_szDtlMsg,"連絡先FAX番号桁あふれ カットしました[CIFNO=%s] 番号=[%s]",
						TMKZs_cifno,TMKZs_renrakusaki_fax );
			send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			TMKZs_renrakusaki_fax[15] = 0x0;
			
		}
    }

    /* 日中連絡先電話番号 値なし許可 */
    if( pData->nicchu_tel_no[0] != 0x00 && pData->nicchu_tel_no[0] != 0x20 ) {
        memcpy( TMKZs_nicchu_tel, pData->nicchu_tel_no, sizeof(pData->nicchu_tel_no) );
        rtrim( TMKZs_nicchu_tel );
        TMKZsi_nicchu_tel=ORA_NOT_NULL;
		/* %03 Add */
		if ( strlen(TMKZs_nicchu_tel) > 15 ) {
			sprintf( g_szDtlMsg,"日中連絡先電話番号桁あふれ カットしました[CIFNO=%s] 番号=[%s]",
						TMKZs_cifno,TMKZs_nicchu_tel );
			send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			TMKZs_nicchu_tel[15] = 0x0;
			
		}
    }

    /* CIF開設日 */
    rc = checkData(pData->start_day, sizeof(pData->start_day),
                   "CIF開設日", TMKZs_deal_day, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_deal_day=ORA_NOT_NULL;
    }

    /* 世帯主フラグ */
    rc = checkData(pData->setai_flg, sizeof(pData->setai_flg),
                   "世帯主フラグ", TMKZs_setai_flg, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_setai_flg=ORA_NOT_NULL;
    }

    /* ホストTM対象区分 */
    rc = checkData(pData->host_tm, sizeof(pData->host_tm),
                   "ホストTM対象区分", TMKZs_host_tm, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_host_tm=ORA_NOT_NULL;
    }

    /* ホストDM対象区分 */
    rc = checkData(pData->host_dm, sizeof(pData->host_dm),
                   "ホストDM対象区分", TMKZs_host_dm, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_host_dm=ORA_NOT_NULL;
    }

    /* 行員区分 */
    rc = checkData(pData->flag01, sizeof(pData->flag01),
                   "行員区分", TMKZs_kouin_kbn, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_kouin_kbn=ORA_NOT_NULL;
    }

    /* 郵便不着 */
    rc = checkData(pData->flag02, sizeof(pData->flag02),
                   "郵便不着", TMKZs_futyaku, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_futyaku=ORA_NOT_NULL;
    }

    /* 会社寮 */
    rc = checkData(pData->flag03, sizeof(pData->flag03),
                   "会社寮", TMKZs_kaisya_ryo, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_kaisya_ryo=ORA_NOT_NULL;
    }

    /* 電話番号間違い */
    rc = checkData(pData->flag04, sizeof(pData->flag04),
                   "電話番号間違い", TMKZs_denwa_matigai, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_denwa_matigai=ORA_NOT_NULL;
    }

    /* 移転 */
    rc = checkData(pData->flag05, sizeof(pData->flag05),
                   "移転", TMKZs_iten, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_iten=ORA_NOT_NULL;
    }

    /* 本人死亡 */
    rc = checkData(pData->flag06, sizeof(pData->flag06),
                   "本人死亡", TMKZs_honnin_sibo, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_honnin_sibo=ORA_NOT_NULL;
    }

    /* 当行金融資産残高 */
    rc = checkData(pData->zandaka, sizeof(pData->zandaka),
                   "当行金融資産残高", TMKZs_zandaka, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_zandaka=ORA_NOT_NULL;
    }

    /* 預り資産残高１ */
    rc = checkData(pData->azukari_shisan1, sizeof(pData->azukari_shisan1),
                   "預り資産残高１", TMKZs_azukari_shisan1, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_azukari_shisan1=ORA_NOT_NULL;
    }

    /* 預り資産残高２ */
    rc = checkData(pData->azukari_shisan2, sizeof(pData->azukari_shisan2),
                   "預り資産残高２", TMKZs_azukari_shisan2, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_azukari_shisan2=ORA_NOT_NULL;
    }

    /* 預り資産残高３ */
    rc = checkData(pData->azukari_shisan3, sizeof(pData->azukari_shisan3),
                   "預り資産残高３", TMKZs_azukari_shisan3, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_azukari_shisan3=ORA_NOT_NULL;
    }

    /* 流動性預金残高 */
    rc = checkData(pData->ryudo_zandaka, sizeof(pData->ryudo_zandaka),
                   "流動性預金残高", TMKZs_ryudo_zandaka, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_ryudo_zandaka=ORA_NOT_NULL;
    }

    /* 定期性預金残高 */
    rc = checkData(pData->teiki_zandaka, sizeof(pData->teiki_zandaka),
                   "定期性預金残高", TMKZs_teiki_zandaka, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_teiki_zandaka=ORA_NOT_NULL;
    }

    /* 仕組預金残高 */
    rc = checkData(pData->shikumi_zandaka, sizeof(pData->shikumi_zandaka),
                   "仕組預金残高", TMKZs_shikumi_zandaka, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_shikumi_zandaka=ORA_NOT_NULL;
    }

    /* 外貨預金残高 */
    rc = checkData(pData->gaika_zandaka, sizeof(pData->gaika_zandaka),
                   "外貨預金残高", TMKZs_gaika_zandaka, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_gaika_zandaka=ORA_NOT_NULL;
    }

    /* 投信残高 */
    rc = checkData(pData->toushin_zandaka, sizeof(pData->toushin_zandaka),
                   "投信残高", TMKZs_toushin_zandaka, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_toushin_zandaka=ORA_NOT_NULL;
    }

    /* 債券残高 */
    rc = checkData(pData->saiken_zandaka, sizeof(pData->saiken_zandaka),
                   "債券残高", TMKZs_saiken_zandaka, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_saiken_zandaka=ORA_NOT_NULL;
    }

    /* リスク商品残高 */
    rc = checkData(pData->risk_zandaka, sizeof(pData->risk_zandaka),
                   "リスク商品残高", TMKZs_risk_zandaka, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_risk_zandaka=ORA_NOT_NULL;
    }

    /* IB契約 */
    rc = checkData(pData->IB_contract, sizeof(pData->IB_contract),
                   "IB契約", TMKZs_IB_contract, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_IB_contract=ORA_NOT_NULL;
    }

    /* IB契約者ID 値なし許可 */
    if( pData->IB_contract_id[0] != 0x00 && pData->IB_contract_id[0] != 0x20 ) {
        memcpy( TMKZs_IB_contract_id, pData->IB_contract_id, sizeof(pData->IB_contract_id) );
        rtrim( TMKZs_IB_contract_id );
        TMKZsi_IB_contract_id=ORA_NOT_NULL;
    }

    /* IB契約申込店番 値なし許可 */
    if( pData->IB_branch_id[0] != 0x00 && pData->IB_branch_id[0] != 0x20 ) {
        memcpy( TMKZs_IB_branch_id, pData->IB_branch_id, sizeof(pData->IB_branch_id) );
        rtrim( TMKZs_IB_branch_id );
        TMKZsi_IB_branch_id=ORA_NOT_NULL;
    }

    /* IB契約代表口座科目 値なし許可 */
    if( pData->IB_accnt_id[0] != 0x00 && pData->IB_accnt_id[0] != 0x20 ) {
        memcpy( TMKZs_IB_accnt_id, pData->IB_accnt_id, sizeof(pData->IB_accnt_id) );
        rtrim( TMKZs_IB_accnt_id );
        TMKZsi_IB_accnt_id=ORA_NOT_NULL;
    }

    /* IB契約代表口座口番号 値なし許可 */
    if( pData->IB_kuchi_no[0] != 0x00 && pData->IB_kuchi_no[0] != 0x20 ) {
        memcpy( TMKZs_IB_kuchi_no, pData->IB_kuchi_no, sizeof(pData->IB_kuchi_no) );
        rtrim( TMKZs_IB_kuchi_no );
        TMKZsi_IB_kuchi_no=ORA_NOT_NULL;
    }

    /* IB契約日 値なし許可 */
    if( pData->IB_contract_day[0] != 0x00 && pData->IB_contract_day[0] != 0x20 ) {
        memcpy( TMKZs_IB_contract_day, pData->IB_contract_day, sizeof(pData->IB_contract_day) );
        rtrim( TMKZs_IB_contract_day );
        TMKZsi_IB_contract_day=ORA_NOT_NULL;
    }

    /* IB契約解除日 値なし許可 */
    if( pData->IB_cancel_day[0] != 0x00 && pData->IB_cancel_day[0] != 0x20 ) {
        memcpy( TMKZs_IB_cancel_day, pData->IB_cancel_day, sizeof(pData->IB_cancel_day) );
        rtrim( TMKZs_IB_cancel_day );
        TMKZsi_IB_cancel_day=ORA_NOT_NULL;
    }

    /* IB契約最終更新日 値なし許可 */
    if( pData->IB_update_day[0] != 0x00 && pData->IB_update_day[0] != 0x20 ) {
        memcpy( TMKZs_IB_update_day, pData->IB_update_day, sizeof(pData->IB_update_day) );
        rtrim( TMKZs_IB_update_day );
        TMKZsi_IB_update_day=ORA_NOT_NULL;
    }

    /* ネット支店契約 */
    rc = checkData(pData->net_contract, sizeof(pData->net_contract),
                   "ネット支店契約", TMKZs_net_contract, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_net_contract=ORA_NOT_NULL;
    }

    /* ネット支店契約者ID 値なし許可 */
    if( pData->net_contract_id[0] != 0x00 && pData->net_contract_id[0] != 0x20 ) {
        memcpy( TMKZs_net_contract_id, pData->net_contract_id, sizeof(pData->net_contract_id) );
        rtrim( TMKZs_net_contract_id );
        TMKZsi_net_contract_id=ORA_NOT_NULL;
    }

    /* ネット支店契約申込店番 値なし許可 */
    if( pData->net_branch_id[0] != 0x00 && pData->net_branch_id[0] != 0x20 ) {
        memcpy( TMKZs_net_branch_id, pData->net_branch_id, sizeof(pData->net_branch_id) );
        rtrim( TMKZs_net_branch_id );
        TMKZsi_net_branch_id=ORA_NOT_NULL;
    }

    /* ネット支店契約代表口座科目 値なし許可 */
    if( pData->net_accnt_id[0] != 0x00 && pData->net_accnt_id[0] != 0x20 ) {
        memcpy( TMKZs_net_accnt_id, pData->net_accnt_id, sizeof(pData->net_accnt_id) );
        rtrim( TMKZs_net_accnt_id );
        TMKZsi_net_accnt_id=ORA_NOT_NULL;
    }

    /* ネット支店契約代表口座口番号 値なし許可 */
    if( pData->net_kuchi_no[0] != 0x00 && pData->net_kuchi_no[0] != 0x20 ) {
        memcpy( TMKZs_net_kuchi_no, pData->net_kuchi_no, sizeof(pData->net_kuchi_no) );
        rtrim( TMKZs_net_kuchi_no );
        TMKZsi_net_kuchi_no=ORA_NOT_NULL;
    }

    /* ネット支店契約日 値なし許可 */
    if( pData->net_contract_day[0] != 0x00 && pData->net_contract_day[0] != 0x20 ) {
        memcpy( TMKZs_net_contract_day, pData->net_contract_day, sizeof(pData->net_contract_day) );
        rtrim( TMKZs_net_contract_day );
        TMKZsi_net_contract_day=ORA_NOT_NULL;
    }

    /* ネット支店契約解除日 値なし許可 */
    if( pData->net_cancel_day[0] != 0x00 && pData->net_cancel_day[0] != 0x20 ) {
        memcpy( TMKZs_net_cancel_day, pData->net_cancel_day, sizeof(pData->net_cancel_day) );
        rtrim( TMKZs_net_cancel_day );
        TMKZsi_net_cancel_day=ORA_NOT_NULL;
    }

    /* ネット支店契約最終更新日 値なし許可 */
    if( pData->net_update_day[0] != 0x00 && pData->net_update_day[0] != 0x20 ) {
        memcpy( TMKZs_net_update_day, pData->net_update_day, sizeof(pData->net_update_day) );
        rtrim( TMKZs_net_update_day );
        TMKZsi_net_update_day=ORA_NOT_NULL;
    }

    /* 職業コード 値なし許可 */
    if( pData->occp_code[0] != 0x00 && pData->occp_code[0] != 0x20 ) {
        memcpy( TMKZs_occp_code, pData->occp_code, sizeof(pData->occp_code) );
        rtrim( TMKZs_occp_code );
        TMKZsi_occp_code=ORA_NOT_NULL;
    }

    /* 年収 値なし許可 */
    if( pData->income[0] != 0x00 && pData->income[0] != 0x20 ) {
        memcpy( TMKZs_income, pData->income, sizeof(pData->income) );
        rtrim( TMKZs_income );
        TMKZsi_income=ORA_NOT_NULL;
    }
    else {
        strcpy(TMKZs_income, "0");
        TMKZsi_income=ORA_NOT_NULL;
    }

    /* 所得年度 値なし許可 */
    if( pData->income_year[0] != 0x00 && pData->income_year[0] != 0x20 ) {
        memcpy( TMKZs_income_year, pData->income_year, sizeof(pData->income_year) );
        rtrim( TMKZs_income_year );
        TMKZsi_income_year=ORA_NOT_NULL;
    }

    /* 取引管理情報 */
    rc = checkData(pData->torikan, sizeof(pData->torikan),
                   "取引管理情報", TMKZs_torikan, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_torikan=ORA_NOT_NULL;
    }

    /* 担当者名 値なし許可 */
    if( pData->operate_name[0] != 0x00 && pData->operate_name[0] != 0x20 ) {
        memcpy( TMKZs_operate_name, pData->operate_name, sizeof(pData->operate_name) );
        rtrim( TMKZs_operate_name );
        TMKZsi_operate_name=ORA_NOT_NULL;
    }

    /* カード発行サイン */
    rc = checkData(pData->card_sign, sizeof(pData->card_sign),
                   "カード発行サイン", TMKZs_card_sign, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_card_sign=ORA_NOT_NULL;
    }

    /* 自宅住所都道府県 */
    /* 処理区分＝変更は値なし許可 */
    if ( atoi(g_RecordID) == AP_C_SYORI_UPDATE ){
        if( pData->adress1[0] != 0x00 && pData->adress1[0] != 0x20 ) {
            memcpy( TMKZs_adress1.arr, pData->adress1,
                    sizeof(pData->adress1) );
            rtrim( TMKZs_adress1.arr );
            TMKZs_adress1.len = (unsigned int)strlen(TMKZs_adress1.arr);
            TMKZsi_adress1=ORA_NOT_NULL;
        }
    }
    else {
        rc = checkData(pData->adress1, sizeof(pData->adress1),
                       "自宅住所都道府県", TMKZs_adress1.arr, g_szDtlMsg);
        if (rc != NORMAL){
            return(ERROR);
        }
        else {
            TMKZs_adress1.len = (unsigned int)strlen(TMKZs_adress1.arr);
            TMKZsi_adress1=ORA_NOT_NULL;
        }
    }

    /* 自宅住所市区町村 */
    if( pData->adress2[0] != 0x00 && pData->adress2[0] != 0x20 ) {
        memcpy( TMKZs_adress2.arr, pData->adress2, sizeof(pData->adress2) );
        rtrim( TMKZs_adress2.arr );
        TMKZs_adress2.len = (unsigned int)strlen(TMKZs_adress2.arr);
        TMKZsi_adress2=ORA_NOT_NULL;
    }

    /* 自宅住所大字通称 */
    if( pData->adress3[0] != 0x00 && pData->adress3[0] != 0x20 ) {
        memcpy( TMKZs_adress3.arr, pData->adress3, sizeof(pData->adress3) );
        rtrim( TMKZs_adress3.arr );
        TMKZs_adress3.len = (unsigned int)strlen(TMKZs_adress3.arr);
        TMKZsi_adress3=ORA_NOT_NULL;
    }

    /* 自宅住所字丁目 */
    if( pData->adress4[0] != 0x00 && pData->adress4[0] != 0x20 ) {
        memcpy( TMKZs_adress4.arr, pData->adress4, sizeof(pData->adress4) );
        rtrim( TMKZs_adress4.arr );
        TMKZs_adress4.len = (unsigned int)strlen(TMKZs_adress4.arr);
        TMKZsi_adress4=ORA_NOT_NULL;
    }

    /* 自宅住所番地 */
    if( pData->adress5[0] != 0x00 && pData->adress5[0] != 0x20 ) {
        memcpy( TMKZs_adress5.arr, pData->adress5, sizeof(pData->adress5) );
        rtrim( TMKZs_adress5.arr );
        TMKZs_adress5.len = (unsigned int)strlen(TMKZs_adress5.arr);
        TMKZsi_adress5=ORA_NOT_NULL;
    }

    /* 自宅住所気付 */
    if( pData->adress6[0] != 0x00 && pData->adress6[0] != 0x20 ) {
        memcpy( TMKZs_adress6.arr, pData->adress6, sizeof(pData->adress6) );
        rtrim( TMKZs_adress6.arr );
        TMKZs_adress6.len = (unsigned int)strlen(TMKZs_adress6.arr);
        TMKZsi_adress6=ORA_NOT_NULL;
    }

    /* 自宅住所都道府県カナ */
    /* 処理区分＝変更は値なし許可 */
    if ( atoi(g_RecordID) == AP_C_SYORI_UPDATE ){
        if( pData->adress_kana1[0] != 0x00 && pData->adress_kana1[0] != 0x20 ) {
            memcpy( TMKZs_adress_kana1.arr, pData->adress_kana1,
                    sizeof(pData->adress_kana1) );
            rtrim( TMKZs_adress_kana1.arr );
            TMKZs_adress_kana1.len = (unsigned int)strlen(TMKZs_adress_kana1.arr);
            TMKZsi_adress_kana1=ORA_NOT_NULL;
        }
    }
    else {
        rc = checkData(pData->adress_kana1, sizeof(pData->adress_kana1),
                       "自宅住所都道府県カナ", TMKZs_adress_kana1.arr, g_szDtlMsg);
        if (rc != NORMAL){
            return(ERROR);
        }
        else {
            TMKZsi_adress_kana1=ORA_NOT_NULL;
        }
    }

    if (TMKZsi_adress_kana1 == ORA_NOT_NULL){

        TMKZs_adress_kana1.len = (unsigned int)strlen(TMKZs_adress_kana1.arr);
    }

    /* 自宅住所市区町村カナ */
    if( pData->adress_kana2[0] != 0x00 && pData->adress_kana2[0] != 0x20 ) {
        memcpy( TMKZs_adress_kana2.arr, pData->adress_kana2,
                sizeof(pData->adress_kana2) );
        rtrim( TMKZs_adress_kana2.arr );
        TMKZs_adress_kana2.len = (unsigned int)strlen(TMKZs_adress_kana2.arr);
        TMKZsi_adress_kana2=ORA_NOT_NULL;
    }
    
    if (TMKZsi_adress_kana2 == ORA_NOT_NULL){

        TMKZs_adress_kana2.len = (unsigned int)strlen(TMKZs_adress_kana2.arr);
    }

    /* 自宅住所大字通称カナ */
    if( pData->adress_kana3[0] != 0x00 && pData->adress_kana3[0] != 0x20 ) {
        memcpy( TMKZs_adress_kana3.arr, pData->adress_kana3,
                sizeof(pData->adress_kana3) );
        rtrim( TMKZs_adress_kana3.arr );
        TMKZs_adress_kana3.len = (unsigned int)strlen(TMKZs_adress_kana3.arr);
        TMKZsi_adress_kana3=ORA_NOT_NULL;
    }

    if (TMKZsi_adress_kana3 == ORA_NOT_NULL){

        TMKZs_adress_kana3.len = (unsigned int)strlen(TMKZs_adress_kana3.arr);
    }

    /* 自宅住所字丁目カナ */
    if( pData->adress_kana4[0] != 0x00 && pData->adress_kana4[0] != 0x20 ) {
        memcpy( TMKZs_adress_kana4.arr, pData->adress_kana4,
                sizeof(pData->adress_kana4) );
        rtrim( TMKZs_adress_kana4.arr );
        TMKZs_adress_kana4.len = (unsigned int)strlen(TMKZs_adress_kana4.arr);
        TMKZsi_adress_kana4=ORA_NOT_NULL;
    }

    if (TMKZsi_adress_kana4 == ORA_NOT_NULL){

		TMKZs_adress_kana4.len = (unsigned int)strlen(TMKZs_adress_kana4.arr);
    }

    /* 自宅住所番地カナ */
    if( pData->adress_kana5[0] != 0x00 && pData->adress_kana5[0] != 0x20 ) {
        memcpy( TMKZs_adress_kana5.arr, pData->adress_kana5,
                sizeof(pData->adress_kana5) );
        rtrim( TMKZs_adress_kana5.arr );
        TMKZs_adress_kana5.len = (unsigned int)strlen(TMKZs_adress_kana5.arr);
        TMKZsi_adress_kana5=ORA_NOT_NULL;
    }

    if (TMKZsi_adress_kana5 == ORA_NOT_NULL){

        TMKZs_adress_kana5.len = (unsigned int)strlen(TMKZs_adress_kana5.arr);
    }

    /* 自宅住所気付カナ */
    if( pData->adress_kana6[0] != 0x00 && pData->adress_kana6[0] != 0x20 ) {
        memcpy( TMKZs_adress_kana6.arr, pData->adress_kana6,
                sizeof(pData->adress_kana6) );
        rtrim( TMKZs_adress_kana6.arr );
        TMKZs_adress_kana6.len = (unsigned int)strlen(TMKZs_adress_kana6.arr);
        TMKZsi_adress_kana6=ORA_NOT_NULL;
    }

    if (TMKZsi_adress_kana6 == ORA_NOT_NULL){

        TMKZs_adress_kana6.len = (unsigned int)strlen(TMKZs_adress_kana6.arr);
    }

    /* 自宅住所 */
    /* 処理区分＝変更は値なし許可 */
    if ( atoi(g_RecordID) == AP_C_SYORI_UPDATE ){
        if( pData->adress[0] != 0x00 && pData->adress[0] != 0x20 ) {
            memcpy( TMKZs_adress.arr, pData->adress,
                    sizeof(pData->adress) );
            rtrim( TMKZs_adress.arr );
            TMKZs_adress.len = (unsigned int)strlen(TMKZs_adress.arr);
            TMKZsi_adress=ORA_NOT_NULL;
        }
    }
    else {
        rc = checkData(pData->adress, sizeof(pData->adress),
                       "自宅住所", TMKZs_adress.arr, g_szDtlMsg);
        if (rc != NORMAL){
            TMKZs_adress.len = (unsigned int)strlen(TMKZs_adress.arr);
            return(ERROR);
        }
        else {
            TMKZs_adress.len = (unsigned int)strlen(TMKZs_adress.arr);
            TMKZsi_adress=ORA_NOT_NULL;
        }
    }

    /* 自宅住所カナ */
    /* 処理区分＝変更は値なし許可 */
    if ( atoi(g_RecordID) == AP_C_SYORI_UPDATE ){
        if( pData->adress_kana[0] != 0x00 && pData->adress_kana[0] != 0x20 ) {
            memcpy( TMKZs_adress_kana.arr, pData->adress_kana,
                    sizeof(pData->adress_kana) );
            rtrim( TMKZs_adress_kana.arr );
            TMKZs_adress_kana.len = (unsigned int)strlen(TMKZs_adress_kana.arr);
            TMKZsi_adress_kana=ORA_NOT_NULL;
        }
    }
    else {
        rc = checkData(pData->adress_kana, sizeof(pData->adress_kana),
                       "自宅住所カナ", TMKZs_adress_kana.arr, g_szDtlMsg);
        if (rc != NORMAL){
            TMKZs_adress_kana.len = (unsigned int)strlen(TMKZs_adress_kana.arr);
            return(ERROR);
        }
        else {
            TMKZs_adress_kana.len = (unsigned int)strlen(TMKZs_adress_kana.arr);
            TMKZsi_adress_kana=ORA_NOT_NULL;
        }
    }

    /* 連絡先住所都道府県 値なし許可 */
    if( pData->renraku_adress1[0] != 0x00 && pData->renraku_adress1[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_adress1.arr, pData->renraku_adress1,
                sizeof(pData->renraku_adress1) );
        rtrim( TMKZs_renrakusaki_adress1.arr );
        TMKZs_renrakusaki_adress1.len = (unsigned int)strlen(TMKZs_renrakusaki_adress1.arr);
        TMKZsi_renrakusaki_adress1=ORA_NOT_NULL;
    }

    /* 連絡先住所市区町村 値なし許可 */
    if( pData->renraku_adress2[0] != 0x00 && pData->renraku_adress2[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_adress2.arr, pData->renraku_adress2,
                sizeof(pData->renraku_adress2) );
        rtrim( TMKZs_renrakusaki_adress2.arr );
        TMKZs_renrakusaki_adress2.len = (unsigned int)strlen(TMKZs_renrakusaki_adress2.arr);
        TMKZsi_renrakusaki_adress2=ORA_NOT_NULL;
    }

    /* 連絡先住所大字通称 値なし許可 */
    if( pData->renraku_adress3[0] != 0x00 && pData->renraku_adress3[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_adress3.arr, pData->renraku_adress3,
                sizeof(pData->renraku_adress3) );
        rtrim( TMKZs_renrakusaki_adress3.arr );
        TMKZs_renrakusaki_adress3.len = (unsigned int)strlen(TMKZs_renrakusaki_adress3.arr);
        TMKZsi_renrakusaki_adress3=ORA_NOT_NULL;
    }

    /* 連絡先住所字丁目 値なし許可 */
    if( pData->renraku_adress4[0] != 0x00 && pData->renraku_adress4[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_adress4.arr, pData->renraku_adress4,
                sizeof(pData->renraku_adress4) );
        rtrim( TMKZs_renrakusaki_adress4.arr );
        TMKZs_renrakusaki_adress4.len = (unsigned int)strlen(TMKZs_renrakusaki_adress4.arr);
        TMKZsi_renrakusaki_adress4=ORA_NOT_NULL;
    }

    /* 連絡先住所番地 値なし許可 */
    if( pData->renraku_adress5[0] != 0x00 && pData->renraku_adress5[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_adress5.arr, pData->renraku_adress5,
                sizeof(pData->renraku_adress5) );
        rtrim( TMKZs_renrakusaki_adress5.arr );
        TMKZs_renrakusaki_adress5.len = (unsigned int)strlen(TMKZs_renrakusaki_adress5.arr);
        TMKZsi_renrakusaki_adress5=ORA_NOT_NULL;
    }

    /* 連絡先住所気付 値なし許可 */
    if( pData->renraku_adress6[0] != 0x00 && pData->renraku_adress6[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_adress6.arr, pData->renraku_adress6,
                sizeof(pData->renraku_adress6) );
        rtrim( TMKZs_renrakusaki_adress6.arr );
        TMKZs_renrakusaki_adress6.len = (unsigned int)strlen(TMKZs_renrakusaki_adress6.arr);
        TMKZsi_renrakusaki_adress6=ORA_NOT_NULL;
    }

    /* 連絡先住所都道府県カナ 値なし許可 */
    if( pData->renraku_adress_kana1[0] != 0x00 && pData->renraku_adress_kana1[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_adress_kana1.arr, pData->renraku_adress_kana1,
                sizeof(pData->renraku_adress_kana1) );
        rtrim( TMKZs_renrakusaki_adress_kana1.arr );
        TMKZsi_renrakusaki_adress_kana1=ORA_NOT_NULL;

        TMKZs_renrakusaki_adress_kana1.len = (unsigned int)strlen(TMKZs_renrakusaki_adress_kana1.arr);
    }

    /* 連絡先住所市区町村カナ 値なし許可 */
    if( pData->renraku_adress_kana2[0] != 0x00 && pData->renraku_adress_kana2[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_adress_kana2.arr, pData->renraku_adress_kana2,
                sizeof(pData->renraku_adress_kana2) );
        rtrim( TMKZs_renrakusaki_adress_kana2.arr );
        TMKZsi_renrakusaki_adress_kana2=ORA_NOT_NULL;

        TMKZs_renrakusaki_adress_kana2.len = (unsigned int)strlen(TMKZs_renrakusaki_adress_kana2.arr);
    }

    /* 連絡先住所大字通称カナ 値なし許可 */
    if( pData->renraku_adress_kana3[0] != 0x00 && pData->renraku_adress_kana3[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_adress_kana3.arr, pData->renraku_adress_kana3,
                sizeof(pData->renraku_adress_kana3) );
        rtrim( TMKZs_renrakusaki_adress_kana3.arr );
        TMKZsi_renrakusaki_adress_kana3=ORA_NOT_NULL;

        TMKZs_renrakusaki_adress_kana3.len = (unsigned int)strlen(TMKZs_renrakusaki_adress_kana3.arr);
    }

    /* 連絡先住所字丁目カナ 値なし許可 */
    if( pData->renraku_adress_kana4[0] != 0x00 && pData->renraku_adress_kana4[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_adress_kana4.arr, pData->renraku_adress_kana4,
                sizeof(pData->renraku_adress_kana4) );
        rtrim( TMKZs_renrakusaki_adress_kana4.arr );
        TMKZsi_renrakusaki_adress_kana4=ORA_NOT_NULL;

        TMKZs_renrakusaki_adress_kana4.len = (unsigned int)strlen(TMKZs_renrakusaki_adress_kana4.arr);
    }

    /* 連絡先住所番地カナ 値なし許可 */
    if( pData->renraku_adress_kana5[0] != 0x00 && pData->renraku_adress_kana5[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_adress_kana5.arr, pData->renraku_adress_kana5,
                sizeof(pData->renraku_adress_kana5) );
        rtrim( TMKZs_renrakusaki_adress_kana5.arr );
        TMKZsi_renrakusaki_adress_kana5=ORA_NOT_NULL;

        TMKZs_renrakusaki_adress_kana5.len = (unsigned int)strlen(TMKZs_renrakusaki_adress_kana5.arr);
    }

    /* 連絡先住所気付カナ 値なし許可 */
    if( pData->renraku_adress_kana6[0] != 0x00 && pData->renraku_adress_kana6[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_adress_kana6.arr, pData->renraku_adress_kana6,
                sizeof(pData->renraku_adress_kana6) );
        rtrim( TMKZs_renrakusaki_adress_kana6.arr );
        TMKZsi_renrakusaki_adress_kana6=ORA_NOT_NULL;

        TMKZs_renrakusaki_adress_kana6.len = (unsigned int)strlen(TMKZs_renrakusaki_adress_kana6.arr);
    }

    /* 連絡先住所 値なし許可 */
    if( pData->renraku_adress[0] != 0x00 && pData->renraku_adress[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_adress.arr, pData->renraku_adress,
                sizeof(pData->renraku_adress) );
        rtrim( TMKZs_renrakusaki_adress.arr );
        TMKZs_renrakusaki_adress.len = (unsigned int)strlen(TMKZs_renrakusaki_adress.arr);
        TMKZsi_renrakusaki_adress=ORA_NOT_NULL;
    }

    /* 連絡先住所カナ 値なし許可 */
    if( pData->renraku_adress_kana[0] != 0x00 && pData->renraku_adress_kana[0] != 0x20 ) {
        memcpy( TMKZs_renrakusaki_adress_kana.arr, pData->renraku_adress_kana,
                sizeof(pData->renraku_adress_kana) );
        rtrim( TMKZs_renrakusaki_adress_kana.arr );
        TMKZs_renrakusaki_adress_kana.len = (unsigned int)strlen(TMKZs_renrakusaki_adress_kana.arr);
        TMKZsi_renrakusaki_adress_kana=ORA_NOT_NULL;
    }

    /* データ基準日 */
    rc = checkData(pData->data_date, sizeof(pData->data_date),
                   "データ基準日", TMKZs_data_date, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_data_date=ORA_NOT_NULL;
    }

    /* マル優 */
    rc = checkData(pData->tax_free, sizeof(pData->tax_free),
                   "マル優", TMKZs_tax_free, g_szDtlMsg);
    if (rc != NORMAL){
        return(ERROR);
    }
    else {
        TMKZsi_tax_free=ORA_NOT_NULL;
    }


    return(NORMAL);

}


/*****************************************************************************/
/* Function Name:                                                            */
/*   int checkData( char *pcheck_data, int data_size, char *pmsg,            */
/*                  char *change_data )                                      */
/*                                                                           */
/* Description:                                                              */
/*   各種チェック                                                            */
/*                                                                           */
/* Arguments:                                                                */
/*   Name          Type/Length  I/O    Content                               */
/* --------------  -----------  ---  -----------------------------------     */
/* char            *pchack_data  I   チェック対象データ                      */
/* int             data_size     I   チェック対象データサイズ                */
/* char            *pmsg         I   メッセージ文字列                        */
/* char            *pchange_data O   チェック後データ                        */
/* g_szDtlMsg       char*        I/O  事象詳細文字列                          */
/*                                                                           */
/* Files:                                                                    */
/*   None                                                                    */
/*                                                                           */
/* Tables:                                                                   */
/*   None                                                                    */
/*                                                                           */
/* Return Code:                                                              */
/*        NORMAL         : 正常                                            */
/*        ERROR : データ不正                                      */
/*                                                                           */
/*****************************************************************************/
/* Process Description:                                                      */
/*                                                                           */
/* Considerations:                                                           */
/*                                                                           */
/* Control Flow:                                                             */
/*                                                                           */
/*****************************************************************************/
static int checkData( char *pcheck_data, int data_size, char *pmsg,
                      char *pchange_data, char *g_szDtlMsg )
{

    if( pcheck_data[0] == 0x00 || pcheck_data[0] == 0x20 ) {
        sprintf( g_szDtlMsg,
                 "[店番=%s CIFNO=%s] %s の設定がありません。",
                 TMKZs_tenban,TMKZs_cifno, pmsg);
        send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
        return(ERROR);
    }
    else {
        memcpy( pchange_data, pcheck_data, data_size);
        rtrim( pchange_data );
    }

    return(NORMAL);
}


/*****************************************************************************/
/* Function Name:                                                            */
/*          int insertTables( char *g_szDtlMsg )                             */
/* Made by:                                                                  */
/* Description : テーブルの登録                                              */
/* Arguments:                                                                */
/*   Name          Type/Length  I/O    Content                               */
/* --------------  -----------  ---  -----------------------------------     */
/* g_szDtlMsg       char*        I/O  事象詳細文字列                         */
/*                                                                           */
/* Files :                                                                   */
/*    None                                                                   */
/* Tables:                                                                   */
/*    None                                                                   */
/* Return Code:                                                              */
/*    NORMAL       : 正常終了                                                */
/*    ERROR        : 挿入エラー                                              */
/*                                                                           */
/*****************************************************************************/
/* Process Description:                                                      */
/*                                                                           */
/* Considerations:                                                           */
/*                                                                           */
/* Control Flow:                                                             */
/*                                                                           */
/*****************************************************************************/
static int insertTables( char *g_szDtlMsg )
{

    /* ------------------------- */
    /* TF_顧客属性テーブルの登録 */
    /* ------------------------- */
	G_POSITION = __LINE__;
	EXEC SQL INSERT INTO TF_顧客属性
       (   店番,
           CIFNO,
           個人企業番号,
           人格区分,
           世帯番号,
           氏名漢字,           氏名漢字更新フラグ,
           氏名カナ,           氏名カナ更新フラグ,
           性別,               性別更新フラグ,
           生年月日,           生年月日更新フラグ,
           住所コード,
           郵便番号,
           補助住所,           住所変更フラグ,
           補助住所カナ,       住所カナ変更フラグ,
           自宅電話番号,       自宅電話番号更新フラグ,
           自宅FAX番号,        自宅FAX番号更新フラグ,
           携帯電話番号,       携帯電話番号更新フラグ,
           MAILアドレス,       MAILアドレス更新フラグ,
           勤務先名,           勤務先名更新フラグ,
           勤務先名カナ,       勤務先名カナ更新フラグ,
           勤務先電話番号,     勤務先電話番号更新フラグ,
           連絡先住所コード,
           連絡先郵便番号,
           連絡先補助住所,     連絡先住所変更フラグ,
           連絡先補助住所カナ, 連絡先住所カナ変更フラグ,
           連絡先電話番号,     連絡先電話番号更新フラグ,
           連絡先FAX番号,      連絡先FAX番号更新フラグ,
           日中連絡先電話番号, 日中連絡先電話番号更新フラグ,
           取引開始日,
		   世帯主フラグ,
           行員区分,
           郵便不着,
           会社寮,
           電話番号間違い,
           移転,
           本人死亡,
			マル優申告額,
           マル優利用額,
           マル特申告額,
           マル特利用額,
		   当行金融資産残高,
           預り資産残高１,
           預り資産残高２,
           預り資産残高３,
           流動性預金残高,
           定期性預金残高,
           仕組預金残高,
           外貨預金残高,
           投信残高,
           債券残高,
           リスク商品残高,
           テレバン契約,
		   テレバン契約日,
		   IB契約,
           IB契約者ID,
           IB契約申込店番,
           IB契約代表口座科目,
           IB契約代表口座口番号,
           IB契約日,
           IB契約解除日,
           IB契約最終更新日,
           ネット支店契約,
           ネット支店契約者ID,
           ネット支店契約申込店番,
           ネット支店契約代表口座科目,
           ネット支店契約代表口座口番号,
           ネット支店契約日,
           ネット支店契約解除日,
           ネット支店契約最終更新日,
           ホストTM対象区分,
           TM対象区分,
           ホストDM対象区分,
           DM対象区分,
		   職業コード,
           年収,
           所得年度,
           取引管理情報,
           担当者名,
           カード発行サイン,
           自宅住所都道府県,
           自宅住所市区町村,
           自宅住所大字通称,
           自宅住所字丁目,
           自宅住所番地,
           自宅住所気付,
           自宅住所都道府県カナ,
           自宅住所市区町村カナ,
           自宅住所大字通称カナ,
           自宅住所字丁目カナ,
           自宅住所番地カナ,
           自宅住所気付カナ,
           自宅住所,
           自宅住所カナ,
           連絡先住所都道府県,
           連絡先住所市区町村,
           連絡先住所大字通称,
           連絡先住所字丁目,
           連絡先住所番地,
           連絡先住所気付,
           連絡先住所都道府県カナ,
           連絡先住所市区町村カナ,
           連絡先住所大字通称カナ,
           連絡先住所字丁目カナ,
           連絡先住所番地カナ,
           連絡先住所気付カナ,
           連絡先住所,
           連絡先住所カナ,
           データ基準日,
		   マル優  
		   )  
		VALUES (
           :TMKZs_tenban :TMKZsi_tenban,
           :TMKZs_cifno :TMKZsi_cifno,
           :TMKZs_kojin_kigyo_no :TMKZsi_kojin_kigyo_no,
           :TMKZs_jinkaku_kbn :TMKZsi_jinkaku_kbn,
           :TMKZs_setai_no :TMKZsi_setai_no,
           :TMKZs_name_knj :TMKZsi_name_knj, ' ',
		   SUBSTRB(:TMKZs_name_kna :TMKZsi_name_kna,1,40), ' ',
           :TMKZs_sex :TMKZsi_sex, ' ',
           :TMKZs_birthday :TMKZsi_birthday, ' ',
           :TMKZs_zip_cd :TMKZsi_zip_cd,
           :TMKZs_zip :TMKZsi_zip,
           :TMKZs_hojo_jyusyo :TMKZsi_hojo_jyusyo, ' ',
           SUBSTRB(:TMKZs_hojo_jyusyo_kana :TMKZsi_hojo_jyusyo_kana,1,60), ' ',
           :TMKZs_jitakutel :TMKZsi_jitakutel, ' ',
           :TMKZs_jitaku_fax :TMKZsi_jitaku_fax, ' ',
           :TMKZs_keitai_tel :TMKZsi_keitai_tel, ' ',
           :TMKZs_mail :TMKZsi_mail, ' ',
           :TMKZs_kinmusaki :TMKZsi_kinmusaki, ' ',
           SUBSTRB(:TMKZs_kinmusaki_kana :TMKZsi_kinmusaki_kana,1.40), ' ',
           :TMKZs_kinmusaki_tel :TMKZsi_kinmusaki_tel, ' ',
           :TMKZs_renrakusaki_zip_cd :TMKZsi_renrakusaki_zip_cd,
           :TMKZs_renrakusaki_zip :TMKZsi_renrakusaki_zip,
           :TMKZs_renrakusaki_hojo_jyusyo :TMKZsi_renrakusaki_hojo_jyusyo, ' ',
           SUBSTRB(:TMKZs_renrakusaki_hojo_jyusyo_kana :TMKZsi_renrakusaki_hojo_jyusyo_kana,1,60), ' ',
           :TMKZs_renrakusaki_tel :TMKZsi_renrakusaki_tel, ' ',
           :TMKZs_renrakusaki_fax :TMKZsi_renrakusaki_fax, ' ',
           :TMKZs_nicchu_tel :TMKZsi_nicchu_tel, ' ',
           :TMKZs_deal_day :TMKZsi_deal_day,
		   :TMKZs_setai_flg :TMKZsi_setai_flg,
           :TMKZs_kouin_kbn :TMKZsi_kouin_kbn,
           :TMKZs_futyaku :TMKZsi_futyaku,
           :TMKZs_kaisya_ryo :TMKZsi_kaisya_ryo,
           :TMKZs_denwa_matigai :TMKZsi_denwa_matigai,
           :TMKZs_iten :TMKZsi_iten,
           :TMKZs_honnin_sibo :TMKZsi_honnin_sibo,
		   0.00,
           0.00,
           0.00,
           0.00,
		   TO_NUMBER(:TMKZs_zandaka, '999999999999999'),
		   TO_NUMBER(:TMKZs_azukari_shisan1, '999999999999999'),
           TO_NUMBER(:TMKZs_azukari_shisan2, '999999999999999'),
           TO_NUMBER(:TMKZs_azukari_shisan3, '999999999999999'),
           TO_NUMBER(:TMKZs_ryudo_zandaka, '999999999999999'),
           TO_NUMBER(:TMKZs_teiki_zandaka, '999999999999999'),
           TO_NUMBER(:TMKZs_shikumi_zandaka, '999999999999999'),
           TO_NUMBER(:TMKZs_gaika_zandaka, '999999999999999'),
           TO_NUMBER(:TMKZs_toushin_zandaka, '999999999999999'),
           TO_NUMBER(:TMKZs_saiken_zandaka, '999999999999999'),
           TO_NUMBER(:TMKZs_risk_zandaka, '999999999999999'),
           '0',
           ' ',
           :TMKZs_IB_contract :TMKZsi_IB_contract,
           :TMKZs_IB_contract_id :TMKZsi_IB_contract_id,
           :TMKZs_IB_branch_id :TMKZsi_IB_branch_id,
           :TMKZs_IB_accnt_id :TMKZsi_IB_accnt_id,
           :TMKZs_IB_kuchi_no :TMKZsi_IB_kuchi_no,
           :TMKZs_IB_contract_day :TMKZsi_IB_contract_day,
           :TMKZs_IB_cancel_day :TMKZsi_IB_cancel_day,
           :TMKZs_IB_update_day :TMKZsi_IB_update_day,
           :TMKZs_net_contract :TMKZsi_net_contract,
           :TMKZs_net_contract_id :TMKZsi_net_contract_id,
           :TMKZs_net_branch_id :TMKZsi_net_branch_id,
           :TMKZs_net_accnt_id :TMKZsi_net_accnt_id,
           :TMKZs_net_kuchi_no :TMKZsi_net_kuchi_no,
           :TMKZs_net_contract_day :TMKZsi_net_contract_day,
           :TMKZs_net_cancel_day :TMKZsi_net_cancel_day,
           :TMKZs_net_update_day :TMKZsi_net_update_day,
           :TMKZs_host_tm :TMKZsi_host_tm,
           '0',
           :TMKZs_host_dm :TMKZsi_host_dm,
           '0',
		   :TMKZs_occp_code :TMKZsi_occp_code,
           TO_NUMBER(:TMKZs_income,'999999999999999'),
           :TMKZs_income_year :TMKZsi_income_year,
           :TMKZs_torikan :TMKZsi_torikan,
           :TMKZs_operate_name :TMKZsi_operate_name,
           :TMKZs_card_sign :TMKZsi_card_sign,
           :TMKZs_adress1 :TMKZsi_adress1,
           :TMKZs_adress2 :TMKZsi_adress2,
           :TMKZs_adress3 :TMKZsi_adress3,
           :TMKZs_adress4 :TMKZsi_adress4,
           :TMKZs_adress5 :TMKZsi_adress5,
           :TMKZs_adress6 :TMKZsi_adress6,
           :TMKZs_adress_kana1 :TMKZsi_adress_kana1,
           :TMKZs_adress_kana2 :TMKZsi_adress_kana2,
           :TMKZs_adress_kana3 :TMKZsi_adress_kana3,
           :TMKZs_adress_kana4 :TMKZsi_adress_kana4,
           :TMKZs_adress_kana5 :TMKZsi_adress_kana5,
           :TMKZs_adress_kana6 :TMKZsi_adress_kana6,
           :TMKZs_adress :TMKZsi_adress,
           SUBSTRB(:TMKZs_adress_kana :TMKZsi_adress_kana,1,170),
           :TMKZs_renrakusaki_adress1 :TMKZsi_renrakusaki_adress1,
           :TMKZs_renrakusaki_adress2 :TMKZsi_renrakusaki_adress2,
           :TMKZs_renrakusaki_adress3 :TMKZsi_renrakusaki_adress3,
           :TMKZs_renrakusaki_adress4 :TMKZsi_renrakusaki_adress4,
           :TMKZs_renrakusaki_adress5 :TMKZsi_renrakusaki_adress5,
           :TMKZs_renrakusaki_adress6 :TMKZsi_renrakusaki_adress6,
           :TMKZs_renrakusaki_adress_kana1 :TMKZsi_renrakusaki_adress_kana1,
           :TMKZs_renrakusaki_adress_kana2 :TMKZsi_renrakusaki_adress_kana2,
           :TMKZs_renrakusaki_adress_kana3 :TMKZsi_renrakusaki_adress_kana3,
           :TMKZs_renrakusaki_adress_kana4 :TMKZsi_renrakusaki_adress_kana4,
           :TMKZs_renrakusaki_adress_kana5 :TMKZsi_renrakusaki_adress_kana5,
           :TMKZs_renrakusaki_adress_kana6 :TMKZsi_renrakusaki_adress_kana6,
           :TMKZs_renrakusaki_adress :TMKZsi_renrakusaki_adress,
           SUBSTRB(:TMKZs_renrakusaki_adress_kana :TMKZsi_renrakusaki_adress_kana,1,170),
		   :TMKZs_data_date :TMKZsi_data_date,
           :TMKZs_tax_free :TMKZsi_tax_free
       );

	
    /* エラーチェック */
    if (sqlca.sqlcode != 0){
        sprintf( g_szDtlMsg,
                 "顧客属性テーブルの登録に失敗しました。(sqlca.sqlcode=%d)",
                 sqlca.sqlcode );
        send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
		send_err ( m$sql_statment, sqlca.sqlcode, "INSERT TF_顧客属性", NULL, NULL, G_STATION);
        return ERROR;
    }

    return NORMAL;
}


/*****************************************************************************/
/* Function Name:                                                            */
/*          int updateTables( g_szDtlMsg )                                   */
/* Made by:                                                                  */
/* Description : テーブルの更新                                              */
/* Arguments:                                                                */
/*   Name          Type/Length  I/O    Content                               */
/* --------------  -----------  ---  -----------------------------------     */
/* g_szDtlMsg       char*        I/O  事象詳細文字列                         */
/*                                                                           */
/* Files :                                                                   */
/*    None                                                                   */
/* Tables:                                                                   */
/*    None                                                                   */
/* Return Code:                                                              */
/*    NORMAL       : 正常終了                                                */
/*    ERROR        : 更新エラー                                              */
/*                                                                           */
/*****************************************************************************/
/* Process Description:                                                      */
/*                                                                           */
/* Considerations:                                                           */
/*                                                                           */
/* Control Flow:                                                             */
/*                                                                           */
/*****************************************************************************/
static int updateTables( char *g_szDtlMsg )
{

    int rc = NORMAL;
    int attribute_update_flag = 0;

    rc = updateAttribute( g_szDtlMsg, &attribute_update_flag );
    if (rc != NORMAL){
        return(rc);
    }


	/*printf("UPDATE\n");*/

    /* TF_顧客属性テーブルの更新 */
	G_POSITION = __LINE__;
    EXEC SQL UPDATE TF_顧客属性
        SET
            店番 = :TMKZs_tenban :TMKZsi_tenban, 
            個人企業番号 = :TMKZs_kojin_kigyo_no :TMKZsi_kojin_kigyo_no,
            人格区分 = :TMKZs_jinkaku_kbn :TMKZsi_jinkaku_kbn,
            世帯番号 = :TMKZs_setai_no :TMKZsi_setai_no,
            氏名漢字 = :TMKZs_name_knj :TMKZsi_name_knj,
            氏名漢字更新フラグ = :TMKZs_name_knj_flg :TMKZsi_name_knj_flg,
            氏名カナ = SUBSTRB(:TMKZs_name_kna :TMKZsi_name_kna,1,40),
            氏名カナ更新フラグ = :TMKZs_name_kna_flg :TMKZsi_name_kna_flg,
            性別 = :TMKZs_sex :TMKZsi_sex,
            性別更新フラグ = :TMKZs_sex_flg :TMKZsi_sex_flg,
            生年月日 = :TMKZs_birthday :TMKZsi_birthday,
            生年月日更新フラグ = :TMKZs_birthday_flg :TMKZsi_birthday_flg,
            住所コード = :TMKZs_zip_cd :TMKZsi_zip_cd,
            郵便番号 = :TMKZs_zip :TMKZsi_zip,
            補助住所 = :TMKZs_hojo_jyusyo :TMKZsi_hojo_jyusyo,
            補助住所カナ = SUBSTRB(:TMKZs_hojo_jyusyo_kana :TMKZsi_hojo_jyusyo_kana,1,60),
            住所カナ変更フラグ = :TMKZs_address_kana_flg :TMKZsi_address_kana_flg,
            住所変更フラグ = :TMKZs_addressflg :TMKZsi_addressflg,
            自宅電話番号 = :TMKZs_jitakutel :TMKZsi_jitakutel,
            自宅電話番号更新フラグ = :TMKZs_jitakutel_flg :TMKZsi_jitakutel_flg,
            自宅FAX番号 = :TMKZs_jitaku_fax :TMKZsi_jitaku_fax,
            自宅FAX番号更新フラグ = :TMKZs_jitaku_fax_flg :TMKZsi_jitaku_fax_flg,
            携帯電話番号 = :TMKZs_keitai_tel :TMKZsi_keitai_tel,
            MAILアドレス = :TMKZs_mail :TMKZsi_mail,
            勤務先名 = :TMKZs_kinmusaki :TMKZsi_kinmusaki,
            勤務先名カナ = SUBSTRB(:TMKZs_kinmusaki_kana :TMKZsi_kinmusaki_kana,1,40),
            勤務先電話番号 = :TMKZs_kinmusaki_tel :TMKZsi_kinmusaki_tel,
            連絡先住所コード = :TMKZs_renrakusaki_zip_cd :TMKZsi_renrakusaki_zip_cd,
            連絡先郵便番号 = :TMKZs_renrakusaki_zip :TMKZsi_renrakusaki_zip,
            連絡先補助住所 = :TMKZs_renrakusaki_hojo_jyusyo :TMKZsi_renrakusaki_hojo_jyusyo,
            連絡先住所変更フラグ = :TMKZs_renrakusaki_addressflg :TMKZsi_renrakusaki_addressflg,
            連絡先補助住所カナ = SUBSTRB(:TMKZs_renrakusaki_hojo_jyusyo_kana :TMKZsi_renrakusaki_hojo_jyusyo_kana,1,60),
            連絡先住所カナ変更フラグ = :TMKZs_renrakusaki_address_kana_flg :TMKZsi_renrakusaki_address_kana_flg,
            連絡先電話番号 = :TMKZs_renrakusaki_tel :TMKZsi_renrakusaki_tel,
            連絡先電話番号更新フラグ = :TMKZs_renrakusaki_tel_flg :TMKZsi_renrakusaki_tel_flg,
            連絡先FAX番号 = :TMKZs_renrakusaki_fax :TMKZsi_renrakusaki_fax,
            日中連絡先電話番号 = :TMKZs_nicchu_tel :TMKZsi_nicchu_tel,
            日中連絡先電話番号更新フラグ = :TMKZs_nicchu_tel_flg :TMKZsi_nicchu_tel_flg,
            取引開始日 = :TMKZs_deal_day :TMKZsi_deal_day,
            世帯主フラグ = :TMKZs_setai_flg :TMKZsi_setai_flg,
            行員区分 = :TMKZs_kouin_kbn :TMKZsi_kouin_kbn,
            郵便不着 = :TMKZs_futyaku :TMKZsi_futyaku,
            会社寮 = :TMKZs_kaisya_ryo :TMKZsi_kaisya_ryo,
            電話番号間違い = :TMKZs_denwa_matigai :TMKZsi_denwa_matigai,
            移転 = :TMKZs_iten :TMKZsi_iten,
            本人死亡 = :TMKZs_honnin_sibo :TMKZsi_honnin_sibo,
            当行金融資産残高 = TO_NUMBER(:TMKZs_zandaka :TMKZsi_zandaka, '999999999999999'),
            預り資産残高１ = TO_NUMBER(:TMKZs_azukari_shisan1 :TMKZsi_azukari_shisan1, '999999999999999'),
            預り資産残高２ = TO_NUMBER(:TMKZs_azukari_shisan2 :TMKZsi_azukari_shisan2, '999999999999999'),
            預り資産残高３ = TO_NUMBER(:TMKZs_azukari_shisan3 :TMKZsi_azukari_shisan3, '999999999999999'),
            流動性預金残高 = TO_NUMBER(:TMKZs_ryudo_zandaka :TMKZsi_ryudo_zandaka, '999999999999999'),
            定期性預金残高 = TO_NUMBER(:TMKZs_teiki_zandaka :TMKZsi_teiki_zandaka, '999999999999999'),
            仕組預金残高 = TO_NUMBER(:TMKZs_shikumi_zandaka :TMKZsi_shikumi_zandaka,'999999999999999'),
            外貨預金残高 = TO_NUMBER(:TMKZs_gaika_zandaka :TMKZsi_gaika_zandaka, '999999999999999'),
            投信残高 = TO_NUMBER(:TMKZs_toushin_zandaka :TMKZsi_toushin_zandaka, '999999999999999'),
            債券残高 = TO_NUMBER(:TMKZs_saiken_zandaka :TMKZsi_saiken_zandaka, '999999999999999'),
            リスク商品残高 = TO_NUMBER(:TMKZs_risk_zandaka :TMKZsi_risk_zandaka, '999999999999999'),
            IB契約 = :TMKZs_IB_contract :TMKZsi_IB_contract,
            IB契約者ID = :TMKZs_IB_contract_id :TMKZsi_IB_contract_id,
            IB契約申込店番 = :TMKZs_IB_branch_id :TMKZsi_IB_branch_id,
            IB契約代表口座科目 = :TMKZs_IB_accnt_id :TMKZsi_IB_accnt_id,
            IB契約代表口座口番号 = :TMKZs_IB_kuchi_no :TMKZsi_IB_kuchi_no,
            IB契約日 = :TMKZs_IB_contract_day :TMKZsi_IB_contract_day,
            IB契約解除日 = :TMKZs_IB_cancel_day :TMKZsi_IB_cancel_day,
            IB契約最終更新日 = :TMKZs_IB_update_day :TMKZsi_IB_update_day,
            ネット支店契約 = :TMKZs_net_contract :TMKZsi_net_contract,
            ネット支店契約者ID = :TMKZs_net_contract_id :TMKZsi_net_contract_id,
            ネット支店契約申込店番 = :TMKZs_net_branch_id :TMKZsi_net_branch_id,
            ネット支店契約代表口座科目 = :TMKZs_net_accnt_id :TMKZsi_net_accnt_id,
            ネット支店契約代表口座口番号 = :TMKZs_net_kuchi_no :TMKZsi_net_kuchi_no,
            ネット支店契約日 = :TMKZs_net_contract_day :TMKZsi_net_contract_day,
            ネット支店契約解除日 = :TMKZs_net_cancel_day :TMKZsi_net_cancel_day,
            ネット支店契約最終更新日 = :TMKZs_net_update_day :TMKZsi_net_update_day,
            ホストTM対象区分 = :TMKZs_host_tm :TMKZsi_host_tm,
            ホストDM対象区分 = :TMKZs_host_dm :TMKZsi_host_dm,
            職業コード = :TMKZs_occp_code :TMKZsi_occp_code,
            年収 = TO_NUMBER(:TMKZs_income :TMKZsi_income, '999999999999999'),
            所得年度 = :TMKZs_income_year :TMKZsi_income_year,
            取引管理情報 = :TMKZs_torikan :TMKZsi_torikan,
            担当者名 = :TMKZs_operate_name :TMKZsi_operate_name,
            カード発行サイン = :TMKZs_card_sign :TMKZsi_card_sign,
            自宅住所都道府県 = :TMKZs_adress1 :TMKZsi_adress1,
            自宅住所市区町村 = :TMKZs_adress2 :TMKZsi_adress2,
            自宅住所大字通称 = :TMKZs_adress3 :TMKZsi_adress3,
            自宅住所字丁目 = :TMKZs_adress4 :TMKZsi_adress4,
            自宅住所番地 = :TMKZs_adress5 :TMKZsi_adress5,
            自宅住所気付 = :TMKZs_adress6 :TMKZsi_adress6,
            自宅住所都道府県カナ = :TMKZs_adress_kana1 :TMKZsi_adress_kana1,
            自宅住所市区町村カナ = :TMKZs_adress_kana2 :TMKZsi_adress_kana2,
            自宅住所大字通称カナ = :TMKZs_adress_kana3 :TMKZsi_adress_kana3,
            自宅住所字丁目カナ = :TMKZs_adress_kana4 :TMKZsi_adress_kana4,
            自宅住所番地カナ = :TMKZs_adress_kana5 :TMKZsi_adress_kana5,
            自宅住所気付カナ = :TMKZs_adress_kana6 :TMKZsi_adress_kana6,
            自宅住所 = :TMKZs_adress :TMKZsi_adress,
            自宅住所カナ = SUBSTRB(:TMKZs_adress_kana :TMKZsi_adress_kana,1,170),
            連絡先住所都道府県 = :TMKZs_renrakusaki_adress1 :TMKZsi_renrakusaki_adress1,
            連絡先住所市区町村 = :TMKZs_renrakusaki_adress2 :TMKZsi_renrakusaki_adress2,
            連絡先住所大字通称 = :TMKZs_renrakusaki_adress3 :TMKZsi_renrakusaki_adress3,
            連絡先住所字丁目 = :TMKZs_renrakusaki_adress4 :TMKZsi_renrakusaki_adress4,
            連絡先住所番地 = :TMKZs_renrakusaki_adress5 :TMKZsi_renrakusaki_adress5,
            連絡先住所気付 = :TMKZs_renrakusaki_adress6 :TMKZsi_renrakusaki_adress6,
            連絡先住所都道府県カナ = :TMKZs_renrakusaki_adress_kana1 :TMKZsi_renrakusaki_adress_kana1,
            連絡先住所市区町村カナ = :TMKZs_renrakusaki_adress_kana2 :TMKZsi_renrakusaki_adress_kana2,
            連絡先住所大字通称カナ = :TMKZs_renrakusaki_adress_kana3 :TMKZsi_renrakusaki_adress_kana3,
            連絡先住所字丁目カナ = :TMKZs_renrakusaki_adress_kana4 :TMKZsi_renrakusaki_adress_kana4,
            連絡先住所番地カナ = :TMKZs_renrakusaki_adress_kana5 :TMKZsi_renrakusaki_adress_kana5,
            連絡先住所気付カナ = :TMKZs_renrakusaki_adress_kana6 :TMKZsi_renrakusaki_adress_kana6,
            連絡先住所 = :TMKZs_renrakusaki_adress :TMKZsi_renrakusaki_adress,
            連絡先住所カナ = SUBSTRB(:TMKZs_renrakusaki_adress_kana :TMKZsi_renrakusaki_adress_kana,1,170),
            データ基準日 = :TMKZs_data_date :TMKZsi_data_date,
            マル優 = :TMKZs_tax_free :TMKZsi_tax_free

        WHERE
            CIFNO = :TMKZs_cifno;

    if( sqlca.sqlcode != 0 ){
        sprintf( g_szDtlMsg, "TF_顧客属性テーブル更新エラー(sqlca.sqlcode=%d)", sqlca.sqlcode );
        send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
		send_err ( m$sql_statment, sqlca.sqlcode, "UPDATE TF_顧客属性", NULL, NULL, G_STATION);
        return(ERROR);
    }


    /* 削除対象属性変更あり */
    if (attribute_update_flag == 1){
		G_POSITION = __LINE__;
        EXEC SQL EXECUTE IMMEDIATE :sqlcmd_del;
        if( sqlca.sqlcode != 0 ) {
            sprintf( g_szDtlMsg, "TD_属性変更情報削除エラー(sqlca.sqlcode=%d)", sqlca.sqlcode );
            send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			sprintf( g_szDtlMsg, "%s", sqlcmd_del );
			send_err ( m$sql_statment, sqlca.sqlcode, g_szDtlMsg, NULL, NULL, G_STATION);
            rc = ERROR;
            return(ERROR);
        }
    }

    return NORMAL;
}


/*****************************************************************************/
/* Function Name:                                                            */
/*          int updateAttribute( g_szDtlMsg )                                */
/* Made by:                                                                  */
/* Description : 属性変更                                                    */
/* Arguments:                                                                */
/*   Name          Type/Length  I/O    Content                               */
/* --------------  -----------  ---  -----------------------------------     */
/* g_szDtlMsg       char*        I/O  事象詳細文字列                         */
/* attribute_flag  int*         I/O  属性変更削除有無                        */
/*                                                                           */
/* Files :                                                                   */
/*    None                                                                   */
/* Tables:                                                                   */
/*    None                                                                   */
/* Return Code:                                                              */
/*    NORMAL       : 正常終了                                                */
/*    ERROR        : 検索エラー         　                                   */
/*                                                                           */
/*****************************************************************************/
/* Process Description:                                                      */
/*                                                                           */
/* Considerations:                                                           */
/*                                                                           */
/* Control Flow:                                                             */
/*                                                                           */
/*****************************************************************************/
static int updateAttribute( char *g_szDtlMsg, int *attribute_flag )
{

    char  address_buff[1024];
    char  chg_address_buff[1024];


    (*attribute_flag) = 0;

    memset( sqlcmd_del, 0x00, sizeof(sqlcmd_del) );

    strcpy( sqlcmd_del, "DELETE FROM " );
    strcat( sqlcmd_del, "TD_属性変更情報 WHERE CIFNO='" );
    strcat( sqlcmd_del, TMKZs_cifno );
    strcat( sqlcmd_del, "' AND 属性ID IN (" );

    memset( &name_knj, 0x00, sizeof(name_knj) );
    ind_name_knj = ORA_NULL;
    memset( &name_kna, 0x00, sizeof(name_kna) );
    ind_name_kna = ORA_NULL;
    memset( sex, 0x00, sizeof(sex) );
    ind_sex = ORA_NULL;
    memset( birthday, 0x00, sizeof(birthday) );
    ind_birthday = ORA_NULL;
    memset( address_code, 0x00, sizeof(address_code) );
    ind_address_code = ORA_NULL;
    memset( jitaku_tel, 0x00, sizeof(jitaku_tel) );
    ind_jitaku_tel = ORA_NULL;
    memset( jitaku_fax, 0x00, sizeof(jitaku_fax) );
    ind_jitaku_fax = ORA_NULL;
    memset( renraku_address_code, 0x00, sizeof(renraku_address_code) );
    ind_renraku_address_code = ORA_NULL;
    memset( renraku_tel, 0x00, sizeof(renraku_tel) );
    ind_renraku_tel = ORA_NULL;
    memset( nicchu_tel, 0x00, sizeof(nicchu_tel) );
    ind_nicchu_tel = ORA_NULL;
    memset( &address, 0x00, sizeof(address) );
    ind_address = ORA_NULL;
    memset( &address1, 0x00, sizeof(address1) );
    ind_address1 = ORA_NULL;
    memset( &address2, 0x00, sizeof(address2) );
    ind_address2 = ORA_NULL;
    memset( &address3, 0x00, sizeof(address3) );
    ind_address3 = ORA_NULL;
    memset( &address4, 0x00, sizeof(address4) );
    ind_address4 = ORA_NULL;
    memset( &address5, 0x00, sizeof(address5) );
    ind_address5 = ORA_NULL;
    memset( &address6, 0x00, sizeof(address6) );
    ind_address6 = ORA_NULL;
    memset( &address_kana, 0x00, sizeof(address_kana) );
    ind_address_kana = ORA_NULL;
    memset( &address_kana1, 0x00, sizeof(address_kana1) );
    ind_address_kana1 = ORA_NULL;
    memset( &address_kana2, 0x00, sizeof(address_kana2) );
    ind_address_kana2 = ORA_NULL;
    memset( &address_kana3, 0x00, sizeof(address_kana3) );
    ind_address_kana3 = ORA_NULL;
    memset( &address_kana4, 0x00, sizeof(address_kana4) );
    ind_address_kana4 = ORA_NULL;
    memset( &address_kana5, 0x00, sizeof(address_kana5) );
    ind_address_kana5 = ORA_NULL;
    memset( &address_kana6, 0x00, sizeof(address_kana6) );
    ind_address_kana6 = ORA_NULL;
    memset( &renraku_address, 0x00, sizeof(renraku_address) );
    ind_renraku_address = ORA_NULL;
    memset( &renraku_address1, 0x00, sizeof(renraku_address1) );
    ind_renraku_address1 = ORA_NULL;
    memset( &renraku_address2, 0x00, sizeof(renraku_address2) );
    ind_renraku_address2 = ORA_NULL;
    memset( &renraku_address3, 0x00, sizeof(renraku_address3) );
    ind_renraku_address3 = ORA_NULL;
    memset( &renraku_address4, 0x00, sizeof(renraku_address4) );
    ind_renraku_address4 = ORA_NULL;
    memset( &renraku_address5, 0x00, sizeof(renraku_address5) );
    ind_renraku_address5 = ORA_NULL;
    memset( &renraku_address6, 0x00, sizeof(renraku_address6) );
    ind_renraku_address6 = ORA_NULL;
    memset( &renraku_address_kana, 0x00, sizeof(renraku_address_kana) );
    ind_renraku_address_kana = ORA_NULL;
    memset( &renraku_address_kana1, 0x00, sizeof(renraku_address_kana1) );
    ind_renraku_address_kana1 = ORA_NULL;
    memset( &renraku_address_kana2, 0x00, sizeof(renraku_address_kana2) );
    ind_renraku_address_kana2 = ORA_NULL;
    memset( &renraku_address_kana3, 0x00, sizeof(renraku_address_kana3) );
    ind_renraku_address_kana3 = ORA_NULL;
    memset( &renraku_address_kana4, 0x00, sizeof(renraku_address_kana4) );
    ind_renraku_address_kana4 = ORA_NULL;
    memset( &renraku_address_kana5, 0x00, sizeof(renraku_address_kana5) );
    ind_renraku_address_kana5 = ORA_NULL;
    memset( &renraku_address_kana6, 0x00, sizeof(renraku_address_kana6) );
    ind_renraku_address_kana6 = ORA_NULL;

	/*printf("SELECT\n");*/
    /* ------------------------- */
    /* TF_顧客属性テーブルの読込 */
    /* ------------------------- */
	G_POSITION = __LINE__;
    EXEC SQL SELECT COALESCE(氏名漢字更新フラグ ,' '),
                    氏名漢字,
                    COALESCE(氏名カナ更新フラグ ,' '),
                    氏名カナ,
                    COALESCE(性別更新フラグ ,' '),
                    性別,
                    COALESCE(生年月日更新フラグ ,' '),
                    生年月日,
                    COALESCE(住所変更フラグ ,' '),
                    住所コード,
                    郵便番号,
                    補助住所,
                    自宅住所,
                    自宅住所都道府県,
                    自宅住所市区町村,
                    自宅住所大字通称,
                    自宅住所字丁目,
                    自宅住所番地,
                    自宅住所気付,
                    COALESCE(自宅電話番号更新フラグ ,' '),
                    自宅電話番号,
                    COALESCE(自宅FAX番号更新フラグ ,' '),
                    自宅FAX番号,
                    COALESCE(連絡先電話番号更新フラグ ,' '),
                    連絡先電話番号,
                    COALESCE(住所カナ変更フラグ ,' '),
                    補助住所カナ,
                    自宅住所カナ,
                    自宅住所都道府県カナ,
                    自宅住所市区町村カナ,
                    自宅住所大字通称カナ,
                    自宅住所字丁目カナ,
                    自宅住所番地カナ,
                    自宅住所気付カナ,
                    COALESCE(連絡先住所変更フラグ ,' '),
                    連絡先住所コード,
                    連絡先郵便番号,
                    連絡先補助住所,
                    連絡先住所,
                    連絡先住所都道府県,
                    連絡先住所市区町村,
                    連絡先住所大字通称,
                    連絡先住所字丁目,
                    連絡先住所番地,
                    連絡先住所気付,
                    COALESCE(連絡先住所カナ変更フラグ ,' '),
                    連絡先補助住所カナ,
                    連絡先住所カナ,
                    連絡先住所都道府県カナ,
                    連絡先住所市区町村カナ,
                    連絡先住所大字通称カナ,
                    連絡先住所字丁目カナ,
                    連絡先住所番地カナ,
                    連絡先住所気付カナ,
                    COALESCE(日中連絡先電話番号更新フラグ ,' '),
                    日中連絡先電話番号
               INTO :TMKZs_name_knj_flg :TMKZsi_name_knj_flg,
                    :name_knj :ind_name_knj,
                    :TMKZs_name_kna_flg :TMKZsi_name_kna_flg,
                    :name_kna :ind_name_kna,
                    :TMKZs_sex_flg :TMKZsi_sex_flg,
                    :sex :ind_sex,
                    :TMKZs_birthday_flg :TMKZsi_birthday_flg,
                    :birthday :ind_birthday,
                    :TMKZs_addressflg :TMKZsi_addressflg,
                    :address_code :ind_address_code,
                    :address_no :ind_address_no,
                    :address_sub :ind_address_sub,
                    :address :ind_address,
                    :address1 :ind_address1,
                    :address2 :ind_address2,
                    :address3 :ind_address3,
                    :address4 :ind_address4,
                    :address5 :ind_address5,
                    :address6 :ind_address6,
                    :TMKZs_jitakutel_flg :TMKZsi_jitakutel_flg,
                    :jitaku_tel :ind_jitaku_tel,
                    :TMKZs_jitaku_fax_flg :TMKZsi_jitaku_fax_flg,
                    :jitaku_fax :ind_jitaku_fax,
                    :TMKZs_renrakusaki_tel_flg :TMKZsi_renrakusaki_tel_flg,
                    :renraku_tel :ind_renraku_tel,
                    :TMKZs_address_kana_flg :TMKZsi_address_kana_flg,
                    :address_sub_kana :ind_address_sub_kana,
                    :address_kana :ind_address_kana,
                    :address_kana1 :ind_address_kana1,
                    :address_kana2 :ind_address_kana2,
                    :address_kana3 :ind_address_kana3,
                    :address_kana4 :ind_address_kana4,
                    :address_kana5 :ind_address_kana5,
                    :address_kana6 :ind_address_kana6,
                    :TMKZs_renrakusaki_addressflg :TMKZsi_renrakusaki_addressflg,
                    :renraku_address_code :ind_renraku_address_code,
                    :renraku_address_no :ind_renraku_address_no,
                    :renraku_address_sub :ind_renraku_address_sub,
                    :renraku_address :ind_renraku_address,
                    :renraku_address1 :ind_renraku_address1,
                    :renraku_address2 :ind_renraku_address2,
                    :renraku_address3 :ind_renraku_address3,
                    :renraku_address4 :ind_renraku_address4,
                    :renraku_address5 :ind_renraku_address5,
                    :renraku_address6 :ind_renraku_address6,
                    :TMKZs_renrakusaki_address_kana_flg :TMKZsi_renrakusaki_address_kana_flg,
                    :renraku_address_sub_kana :ind_renraku_address_sub_kana,
                    :renraku_address_kana :ind_renraku_address_kana,
                    :renraku_address_kana1 :ind_renraku_address_kana1,
                    :renraku_address_kana2 :ind_renraku_address_kana2,
                    :renraku_address_kana3 :ind_renraku_address_kana3,
                    :renraku_address_kana4 :ind_renraku_address_kana4,
                    :renraku_address_kana5 :ind_renraku_address_kana5,
                    :renraku_address_kana6 :ind_renraku_address_kana6,
                    :TMKZs_nicchu_tel_flg :TMKZsi_nicchu_tel_flg,
                    :nicchu_tel :ind_nicchu_tel
               FROM TF_顧客属性
              WHERE CIFNO = :TMKZs_cifno
              ;
    if( sqlca.sqlcode != 0 && sqlca.sqlcode != ORA_NOF ) {
        sprintf( g_szDtlMsg, "TF_顧客属性テーブルの検索に失敗しました。(sqlca.sqlcode=%d)", sqlca.sqlcode );
		send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
		send_err ( m$sql_statment, sqlca.sqlcode, "SELECT TF_顧客属性", NULL, NULL, G_STATION);
        return( ERROR );
    }


    /* ----------------------------------------------------- */
    /* TD_TM属性変更情報の変更前とファイルを比較。           */
    /* 同一：eMuSCが新として更新なし。                       */
    /* 相違：HOSTが新として更新（TF_顧客属性）。             */
    /*       該当属性の属性変更を削除（TD_TM属性変更情報）。 */
    /* ----------------------------------------------------- */

    /* ---------------------- */
    /* 氏名漢字の更新チェック */
    /* ---------------------- */
    if ( TMKZs_name_knj_flg[0] == '*' ) {
        memset( batch_chg_before.arr, 0x00, sizeof(batch_chg_before.arr) );

		G_POSITION = __LINE__;
        EXEC SQL SELECT バッチ用変更前 INTO :batch_chg_before :ind_batch_chg_before
                   FROM TD_属性変更情報
                  WHERE 属性ID = '0001'
                    AND CIFNO  = :TMKZs_cifno;
        if ( sqlca.sqlcode != 0 && sqlca.sqlcode != ORA_NOF ) {
            sprintf( g_szDtlMsg, "TD_属性変更情報テーブルの検索に失敗しました。(sqlca.sqlcode=%d)", sqlca.sqlcode );
            send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			send_err ( m$sql_statment, sqlca.sqlcode, "SELECT TD_属性変更情報(氏名漢字)", NULL, NULL, G_STATION);
            return( ERROR );
        }
        else if (sqlca.sqlcode == 0){
            if( ind_batch_chg_before != ORA_NULL ) {
                batch_chg_before.arr[batch_chg_before.len]=0x00;
            }
            else {
                memset( batch_chg_before.arr, 0x00, sizeof(batch_chg_before.arr) );
            }

            strCodeChange( batch_chg_before.arr );
            strCodeChange( TMKZs_name_knj.arr );


            /* 変更前とHOSTが異なる→HOSTの値で更新 */
            if ( strcmp( batch_chg_before.arr, TMKZs_name_knj.arr ) != 0 ) {
                /* 変更フラグクリア */
                strcpy(TMKZs_name_knj_flg, " ");
                TMKZsi_name_knj_flg = ORA_NOT_NULL;

                /* TD_属性変更情報から削除 */
                strcat( sqlcmd_del, "'0001'" );
                (*attribute_flag) = 1;
            }
            else {
                /* 更新なし */
                memcpy( &TMKZs_name_knj, &name_knj, sizeof(TMKZs_name_knj) );
                TMKZsi_name_knj = ind_name_knj;
            }
        }
    }


    /* ---------------------- */
    /* 氏名カナの更新チェック */
    /* ---------------------- */
    if ( TMKZs_name_kna_flg[0] == '*' ) {
        memset( batch_chg_before.arr, 0x00, sizeof(batch_chg_before.arr) );

		G_POSITION = __LINE__;
		EXEC SQL SELECT バッチ用変更前 INTO :batch_chg_before :ind_batch_chg_before
                   FROM TD_属性変更情報
                  WHERE 属性ID = '0002'
                    AND CIFNO  = :TMKZs_cifno;
        if( sqlca.sqlcode != 0 && sqlca.sqlcode != ORA_NOF ) {
            sprintf( g_szDtlMsg, "TD_属性変更情報テーブルの検索に失敗しました。(sqlca.sqlcode=%d)", sqlca.sqlcode );
            send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			send_err ( m$sql_statment, sqlca.sqlcode, "SELECT TD_属性変更情報(氏名カナ)", NULL, NULL, G_STATION);
            return( ERROR );
        }
        else if (sqlca.sqlcode == 0){
            if( ind_batch_chg_before != ORA_NULL ) {
                batch_chg_before.arr[batch_chg_before.len]=0x00;
            }
            else {
                memset( batch_chg_before.arr, 0x00, sizeof(batch_chg_before.arr) );
            }

            /* 変更前とHOSTが異なる→HOSTの値で更新 */
            if ( strcmp( batch_chg_before.arr, TMKZs_name_kna.arr ) != 0 ) {
                /* 変更フラグクリア */
                strcpy(TMKZs_name_kna_flg, " ");
                TMKZsi_name_kna_flg = ORA_NOT_NULL;

                /* 属性変更あり */
                if ( (*attribute_flag) == 1 ){
                    strcat( sqlcmd_del, ", " );
                }
                else {
                    (*attribute_flag) = 1;
                }
                /* TD_属性変更情報から削除 */
                strcat( sqlcmd_del, "'0002'" );
            }
            else {
                /* 更新なし */
                memcpy( &TMKZs_name_kna, &name_kna, sizeof(TMKZs_name_kna) );
                TMKZsi_name_kna = ind_name_kna;
            }
        }
    }


    /* ------------------ */
    /* 性別の更新チェック */
    /* ------------------ */
    if ( TMKZs_sex_flg[0] == '*' ) {
        memset( batch_chg_before.arr, 0x00, sizeof(batch_chg_before.arr) );

		G_POSITION = __LINE__;
        EXEC SQL SELECT バッチ用変更前 INTO :batch_chg_before:ind_batch_chg_before
                   FROM TD_属性変更情報
                  WHERE 属性ID = '0003'
                    AND CIFNO  = :TMKZs_cifno;
        if( sqlca.sqlcode != 0 && sqlca.sqlcode != ORA_NOF ) {
            sprintf( g_szDtlMsg, "TD_属性変更情報テーブルの検索に失敗しました。(sqlca.sqlcode=%d)", sqlca.sqlcode );
            send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			send_err ( m$sql_statment, sqlca.sqlcode, "SELECT TD_属性変更情報(性別)", NULL, NULL, G_STATION);
            return( ERROR );
        }
        else if (sqlca.sqlcode == 0){
            if( ind_batch_chg_before != ORA_NULL ) {
                batch_chg_before.arr[batch_chg_before.len]=0x00;
            }
            else {
                memset( batch_chg_before.arr, 0x00, sizeof(batch_chg_before.arr) );
            }

            /* 変更前とHOSTが異なる→HOSTの値で更新 */
            if ( strcmp( batch_chg_before.arr, TMKZs_sex ) != 0 ) {
                /* 変更フラグクリア */
                strcpy(TMKZs_sex_flg, " ");
                TMKZsi_sex_flg = ORA_NOT_NULL;

                /* 属性変更あり */
                if ( (*attribute_flag) == 1 ){
                    strcat( sqlcmd_del, ", " );
                }
                else {
                    (*attribute_flag) = 1;
                }
                /* TD_属性変更情報から削除 */
                strcat( sqlcmd_del, "'0003'" );
            }
            else {
                /* 更新なし */
                memcpy( TMKZs_sex, sex, sizeof(TMKZs_sex) );
                TMKZsi_sex = ind_sex;
            }
        }
    }

    /* ---------------------- */
    /* 生年月日の更新チェック */
    /* ---------------------- */
    if ( TMKZs_birthday_flg[0] == '*' ) {
        memset( batch_chg_before.arr, 0x00, sizeof(batch_chg_before.arr) );

		G_POSITION = __LINE__;
        EXEC SQL SELECT バッチ用変更前 INTO :batch_chg_before:ind_batch_chg_before
                   FROM TD_属性変更情報
                  WHERE 属性ID = '0004'
                    AND CIFNO  = :TMKZs_cifno;
        if( sqlca.sqlcode != 0 && sqlca.sqlcode != ORA_NOF ) {
            sprintf( g_szDtlMsg, "TD_属性変更情報テーブルの検索に失敗しました。(sqlca.sqlcode=%d)", sqlca.sqlcode );
            send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			send_err ( m$sql_statment, sqlca.sqlcode, "SELECT TD_属性変更情報(生年月日)", NULL, NULL, G_STATION);
            return( ERROR );
        }
        else if (sqlca.sqlcode == 0){
            if( ind_batch_chg_before != ORA_NULL ) {
                batch_chg_before.arr[batch_chg_before.len]=0x00;
            }
            else {
                memset( batch_chg_before.arr, 0x00, sizeof(batch_chg_before.arr) );
            }

            /* 変更前とHOSTが異なる→HOSTの値で更新 */
            if ( strcmp( batch_chg_before.arr, TMKZs_birthday ) != 0 ) {
                /* 変更フラグクリア */
                strcpy(TMKZs_birthday_flg, " ");
                TMKZsi_birthday_flg = ORA_NOT_NULL;

                /* 属性変更あり */
                if ( (*attribute_flag) == 1 ){
                    strcat( sqlcmd_del, ", " );
                }
                else {
                    (*attribute_flag) = 1;
                }
                /* TD_属性変更情報から削除 */
                strcat( sqlcmd_del, "'0004'" );
            }
            else {
                /* 更新なし */
                memcpy( TMKZs_birthday, birthday, sizeof(TMKZs_birthday) );
                TMKZsi_birthday = ind_birthday;
            }
        }
    }


	/* ------------------ */
    /* 住所の更新チェック */
    /* ------------------ */
    if ( TMKZs_addressflg[0] == '*' ) {
        memset( chg_before1.arr, 0x00, sizeof(chg_before1.arr) );
        chg_before1.len = 0;
        memset( chg_before2.arr, 0x00, sizeof(chg_before2.arr) );
        chg_before2.len = 0;
        memset( chg_before3.arr, 0x00, sizeof(chg_before3.arr) );
        chg_before3.len = 0;
        memset( chg_before4.arr, 0x00, sizeof(chg_before4.arr) );
        chg_before4.len = 0;

		G_POSITION = __LINE__;
        EXEC SQL SELECT RTRIM(変更前1),
                        RTRIM(変更前2),
                        RTRIM(変更前3),
                        RTRIM(変更前4)
                   INTO :chg_before1:ind_chg_before1,
                        :chg_before2:ind_chg_before2,
                        :chg_before3:ind_chg_before3,
                        :chg_before4:ind_chg_before4
                   FROM TD_属性変更情報
                  WHERE 属性ID = '0005'
                    AND CIFNO  = :TMKZs_cifno;
        if( sqlca.sqlcode != 0 && sqlca.sqlcode != ORA_NOF ) {
            sprintf( g_szDtlMsg, "TD_属性変更情報テーブルの検索に失敗しました。(sqlca.sqlcode=%d)", sqlca.sqlcode );
            send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			send_err ( m$sql_statment, sqlca.sqlcode, "SELECT TD_属性変更情報(住所)", NULL, NULL, G_STATION);
            return( ERROR );
        }
        else if (sqlca.sqlcode == 0){
            /* 変更前：郵便番号＋都道府県市区町村＋大字通称字丁目＋番地気付 */
            memset( chg_address_buff, 0x00, sizeof(chg_address_buff) );

            if( ind_chg_before1 != ORA_NULL ) {
                strncpy( chg_address_buff, chg_before1.arr, chg_before1.len );
            }
            if( ind_chg_before2 != ORA_NULL ) {
                strncat( chg_address_buff, chg_before2.arr, chg_before2.len );
            }
            if( ind_chg_before3 != ORA_NULL ) {
                strncat( chg_address_buff, chg_before3.arr, chg_before3.len );
            }
            if( ind_chg_before4 != ORA_NULL ) {
                strncat( chg_address_buff, chg_before4.arr, chg_before4.len );
            }

            /* ホスト：郵便番号＋都道府県＋市区町村＋大字通称＋字丁目＋番地＋気付 */
            memset( address_buff, 0x00, sizeof(address_buff) );
            strcpy( address_buff, TMKZs_zip );
            strncat( address_buff, TMKZs_adress1.arr, TMKZs_adress1.len );
            strncat( address_buff, TMKZs_adress2.arr, TMKZs_adress2.len );
            strncat( address_buff, TMKZs_adress3.arr, TMKZs_adress3.len );
            strncat( address_buff, TMKZs_adress4.arr, TMKZs_adress4.len );
            strncat( address_buff, TMKZs_adress5.arr, TMKZs_adress5.len );
            strncat( address_buff, TMKZs_adress6.arr, TMKZs_adress6.len );

            strCodeChange( chg_address_buff );
            strCodeChange( address_buff );

            /* 変更前とHOSTが異なる→HOSTの値で更新 */
            if ( strcmp( chg_address_buff, address_buff ) != 0 ) {
                /* 変更フラグクリア */
                strcpy(TMKZs_addressflg, " ");
                TMKZsi_addressflg = ORA_NOT_NULL;

                /* 属性変更あり */
                if ( (*attribute_flag) == 1 ){
                    strcat( sqlcmd_del, ", " );
                }
                else {
                    (*attribute_flag) = 1;
                }
                /* TD_属性変更情報から削除 */
                strcat( sqlcmd_del, "'0005'" );

            }
            else {
                /* 更新なし */
                memcpy( &TMKZs_hojo_jyusyo, &address_sub, sizeof(TMKZs_hojo_jyusyo) );
                TMKZsi_hojo_jyusyo = ind_address_sub;
                memcpy( &TMKZs_adress, &address, sizeof(TMKZs_adress) );
                TMKZsi_adress = ind_address;
                memcpy( &TMKZs_adress1, &address1, sizeof(TMKZs_adress1) );
                TMKZsi_adress1 = ind_address1;
                memcpy( &TMKZs_adress2, &address2, sizeof(TMKZs_adress2) );
                TMKZsi_adress2 = ind_address2;
                memcpy( &TMKZs_adress3, &address3, sizeof(TMKZs_adress3) );
                TMKZsi_adress3 = ind_address3;
                memcpy( &TMKZs_adress4, &address4, sizeof(TMKZs_adress4) );
                TMKZsi_adress4 = ind_address4;
                memcpy( &TMKZs_adress5, &address5, sizeof(TMKZs_adress5) );
                TMKZsi_adress5 = ind_address5;
                memcpy( &TMKZs_adress6, &address6, sizeof(TMKZs_adress6) );
                TMKZsi_adress6 = ind_address6;

                /* 更新なしの場合、住所コード・郵便番号を元の値で更新 */
                memcpy( TMKZs_zip_cd, address_code, sizeof(TMKZs_zip_cd) );
                TMKZsi_zip_cd = ind_address_code;
                memcpy( TMKZs_zip, address_no, sizeof(TMKZs_zip) );
                TMKZsi_zip = ind_address_no;
            }
        }
    }


    /* -------------------------- */
    /* 自宅電話番号の更新チェック */
    /* -------------------------- */
    if ( TMKZs_jitakutel_flg[0] == '*' ) {
        memset( batch_chg_before.arr, 0x00, sizeof(batch_chg_before.arr) );

		G_POSITION = __LINE__;
        EXEC SQL SELECT バッチ用変更前 INTO :batch_chg_before:ind_batch_chg_before
                   FROM TD_属性変更情報
                  WHERE 属性ID = '0006'
                    AND CIFNO  = :TMKZs_cifno;
        if( sqlca.sqlcode != 0 && sqlca.sqlcode != ORA_NOF ) {
            sprintf( g_szDtlMsg, "TD_属性変更情報テーブルの検索に失敗しました。(sqlca.sqlcode=%d)", sqlca.sqlcode );
            send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			send_err ( m$sql_statment, sqlca.sqlcode, "SELECT TD_属性変更情報(自宅電話番号)", NULL, NULL, G_STATION);
            return( ERROR );
        }
        else if (sqlca.sqlcode == 0){
            if( ind_batch_chg_before != ORA_NULL ) {
                batch_chg_before.arr[batch_chg_before.len]=0x00;
            }
            else {
                memset( batch_chg_before.arr, 0x00, sizeof(batch_chg_before.arr) );
            }

            /* 変更前とHOSTが異なる→HOSTの値で更新 */
            if ( strcmp( batch_chg_before.arr, TMKZs_jitakutel ) != 0 ) {
                /* 変更フラグクリア */
                strcpy(TMKZs_jitakutel_flg, " ");
                TMKZsi_jitakutel_flg = ORA_NOT_NULL;

                /* 属性変更あり */
                if ( (*attribute_flag) == 1 ){
                    strcat( sqlcmd_del, ", " );
                }
                else {
                    (*attribute_flag) = 1;
                }
                /* TD_属性変更情報から削除 */
                strcat( sqlcmd_del, "'0006'" );
            }
            else {
                /* 更新なし */
                memcpy( TMKZs_jitakutel, jitaku_tel, sizeof(TMKZs_jitakutel)); 
				rtrim( TMKZs_jitakutel );  /* %01 Add */
                TMKZsi_jitakutel = ind_jitaku_tel;
            }
        }
    }

    /* ------------------------- */
    /* 自宅FAX番号の更新チェック */
    /* ------------------------- */
    if ( TMKZs_jitaku_fax_flg[0] == '*' ) {
        memset( batch_chg_before.arr, 0x00, sizeof(batch_chg_before.arr) );

		G_POSITION = __LINE__;
        EXEC SQL SELECT バッチ用変更前 INTO :batch_chg_before:ind_batch_chg_before
                   FROM TD_属性変更情報
                  WHERE 属性ID = '0007'
                    AND CIFNO  = :TMKZs_cifno;
        if( sqlca.sqlcode != 0 && sqlca.sqlcode != ORA_NOF ) {
            sprintf( g_szDtlMsg, "TD_属性変更情報テーブルの検索に失敗しました。(sqlca.sqlcode=%d)", sqlca.sqlcode );
            send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			send_err ( m$sql_statment, sqlca.sqlcode, "SELECT TD_属性変更情報(自宅FAX番号)", NULL, NULL, G_STATION);
            return( ERROR );
        }
        else if (sqlca.sqlcode == 0){
            if( ind_batch_chg_before != ORA_NULL ) {
                batch_chg_before.arr[batch_chg_before.len]=0x00;
            }
            else {
                memset( batch_chg_before.arr, 0x00, sizeof(batch_chg_before.arr) );
            }

            /* 変更前とHOSTが異なる→HOSTの値で更新 */
            if ( strcmp( batch_chg_before.arr, TMKZs_jitaku_fax ) != 0 ) {
                /* 変更フラグクリア */
                strcpy(TMKZs_jitaku_fax_flg, " ");
                TMKZsi_jitaku_fax_flg = ORA_NOT_NULL;

                /* 属性変更あり */
                if ( (*attribute_flag) == 1 ){
                    strcat( sqlcmd_del, ", " );
                }
                else {
                    (*attribute_flag) = 1;
                }
                /* TD_属性変更情報から削除 */
                strcat( sqlcmd_del, "'0007'" );
            }
            else {
                /* 更新なし */
                memcpy( TMKZs_jitaku_fax, jitaku_fax, sizeof(TMKZs_jitaku_fax) );
				rtrim( TMKZs_jitaku_fax );  /* %01 Add */
                TMKZsi_jitaku_fax = ind_jitaku_fax;
            }
        }
    }


    /* ---------------------------- */
    /* 連絡先電話番号の更新チェック */
    /* ---------------------------- */
    if ( TMKZs_renrakusaki_tel_flg[0] == '*' ) {
        memset( batch_chg_before.arr, 0x00, sizeof(batch_chg_before.arr) );

		G_POSITION = __LINE__;
        EXEC SQL SELECT バッチ用変更前 INTO :batch_chg_before:ind_batch_chg_before
                   FROM TD_属性変更情報
                  WHERE 属性ID = '0012'
                    AND CIFNO  = :TMKZs_cifno;
        if( sqlca.sqlcode != 0 && sqlca.sqlcode != ORA_NOF ) {
            sprintf( g_szDtlMsg, "TD_属性変更情報テーブルの検索に失敗しました。(sqlca.sqlcode=%d)", sqlca.sqlcode );
            send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			send_err ( m$sql_statment, sqlca.sqlcode, "SELECT TD_属性変更情報(連絡先電話番号)", NULL, NULL, G_STATION);
            return( ERROR );
        }
        else if (sqlca.sqlcode == 0){
            if( ind_batch_chg_before != ORA_NULL ) {
                batch_chg_before.arr[batch_chg_before.len]=0x00;
            }
            else {
                memset( batch_chg_before.arr, 0x00, sizeof(batch_chg_before.arr) );
            }

            /* 変更前とHOSTが異なる→HOSTの値で更新 */
            if ( strcmp( batch_chg_before.arr, TMKZs_renrakusaki_tel ) != 0 ) {
                /* 変更フラグクリア */
                strcpy(TMKZs_renrakusaki_tel_flg, " ");
                TMKZsi_renrakusaki_tel_flg = ORA_NOT_NULL;

                /* 属性変更あり */
                if ( (*attribute_flag) == 1 ){
                    strcat( sqlcmd_del, ", " );
                }
                else {
                    (*attribute_flag) = 1;
                }
                /* TD_属性変更情報から削除 */
                strcat( sqlcmd_del, "'0012'" );
            }
            else {
                /* 更新なし */
                memcpy( TMKZs_renrakusaki_tel, renraku_tel, sizeof(TMKZs_renrakusaki_tel) );
				rtrim( TMKZs_renrakusaki_tel );  /* %01 Add */
                TMKZsi_renrakusaki_tel = ind_renraku_tel;
            }
        }
    }

    /* ---------------------- */
    /* 住所カナの更新チェック */
    /* ---------------------- */
    if ( TMKZs_address_kana_flg[0] == '*' ) {
        memset( chg_before1.arr, 0x00, sizeof(chg_before1.arr) );
        chg_before1.len = 0;
        memset( chg_before2.arr, 0x00, sizeof(chg_before2.arr) );
        chg_before2.len = 0;
        memset( chg_before3.arr, 0x00, sizeof(chg_before3.arr) );
        chg_before3.len = 0;
        memset( chg_before4.arr, 0x00, sizeof(chg_before4.arr) );
        chg_before4.len = 0;

		G_POSITION = __LINE__;
        EXEC SQL SELECT RTRIM(変更前1),
                        RTRIM(変更前2),
                        RTRIM(変更前3),
                        RTRIM(変更前4)
                   INTO :chg_before1:ind_chg_before1,
                        :chg_before2:ind_chg_before2,
                        :chg_before3:ind_chg_before3,
                        :chg_before4:ind_chg_before4
                   FROM TD_属性変更情報
                  WHERE 属性ID = '0013'
                    AND CIFNO  = :TMKZs_cifno;
        if( sqlca.sqlcode != 0 && sqlca.sqlcode != ORA_NOF ) {
            sprintf( g_szDtlMsg, "TD_属性変更情報テーブルの検索に失敗しました。(sqlca.sqlcode=%d)", sqlca.sqlcode );
            send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			send_err ( m$sql_statment, sqlca.sqlcode, "SELECT TD_属性変更情報(住所カナ)", NULL, NULL, G_STATION);
            return( ERROR );
        }
        else if (sqlca.sqlcode == 0){
            /* 変更前：都道府県市区町村＋大字通称字丁目＋番地気付 */
            memset( chg_address_buff, 0x00, sizeof(chg_address_buff) );

            if( ind_chg_before1 != ORA_NULL ) {
                strncpy( chg_address_buff, chg_before1.arr, chg_before1.len );
            }
            if( ind_chg_before2 != ORA_NULL ) {
                strncat( chg_address_buff, chg_before2.arr, chg_before2.len );
            }
            if( ind_chg_before3 != ORA_NULL ) {
                strncat( chg_address_buff, chg_before3.arr, chg_before3.len );
            }
            if( ind_chg_before4 != ORA_NULL ) {
                strncat( chg_address_buff, chg_before4.arr, chg_before4.len );
            }

            /* ホスト：都道府県＋市区町村＋大字通称＋字丁目＋番地＋気付 */
            memset( address_buff, 0x00, sizeof(address_buff) );
            strncat( address_buff, TMKZs_adress_kana1.arr, TMKZs_adress_kana1.len );
            strncat( address_buff, TMKZs_adress_kana2.arr, TMKZs_adress_kana2.len );
            strncat( address_buff, TMKZs_adress_kana3.arr, TMKZs_adress_kana3.len );
            strncat( address_buff, TMKZs_adress_kana4.arr, TMKZs_adress_kana4.len );
            strncat( address_buff, TMKZs_adress_kana5.arr, TMKZs_adress_kana5.len );
            strncat( address_buff, TMKZs_adress_kana6.arr, TMKZs_adress_kana6.len );

            /* 変更前とHOSTが異なる→HOSTの値で更新 */
            if ( strcmp( chg_address_buff, address_buff ) != 0 ) {
                /* 変更フラグクリア */
                strcpy(TMKZs_address_kana_flg, " ");
                TMKZsi_address_kana_flg = ORA_NOT_NULL;

                /* 属性変更あり */
                if ( (*attribute_flag) == 1 ){
                    strcat( sqlcmd_del, ", " );
                }
                else {
                    (*attribute_flag) = 1;
                }
                /* TD_属性変更情報から削除 */
                strcat( sqlcmd_del, "'0013'" );

            }
            else {
                /* 更新なし */
                memcpy( &TMKZs_hojo_jyusyo_kana, &address_sub_kana, sizeof(TMKZs_hojo_jyusyo_kana) );
                TMKZsi_hojo_jyusyo_kana = ind_address_sub_kana;
                memcpy( &TMKZs_adress_kana, &address_kana, sizeof(TMKZs_adress_kana) );
                TMKZsi_adress_kana = ind_address_kana;
                memcpy( &TMKZs_adress_kana1, &address_kana1, sizeof(TMKZs_adress_kana1) );
                TMKZsi_adress_kana1 = ind_address_kana1;
                memcpy( &TMKZs_adress_kana2, &address_kana2, sizeof(TMKZs_adress_kana2) );
                TMKZsi_adress_kana2 = ind_address_kana2;
                memcpy( &TMKZs_adress_kana3, &address_kana3, sizeof(TMKZs_adress_kana3) );
                TMKZsi_adress_kana3 = ind_address_kana3;
                memcpy( &TMKZs_adress_kana4, &address_kana4, sizeof(TMKZs_adress_kana4) );
                TMKZsi_adress_kana4 = ind_address_kana4;
                memcpy( &TMKZs_adress_kana5, &address_kana5, sizeof(TMKZs_adress_kana5) );
                TMKZsi_adress_kana5 = ind_address_kana5;
                memcpy( &TMKZs_adress_kana6, &address_kana6, sizeof(TMKZs_adress_kana6) );
                TMKZsi_adress_kana6 = ind_address_kana6;
            }
        }
    }

	/* ------------------------ */
    /* 連絡先住所の更新チェック */
    /* ------------------------ */
    if ( TMKZs_renrakusaki_addressflg[0] == '*' ) {
        memset( chg_before1.arr, 0x00, sizeof(chg_before1.arr) );
        chg_before1.len = 0;
        memset( chg_before2.arr, 0x00, sizeof(chg_before2.arr) );
        chg_before2.len = 0;
        memset( chg_before3.arr, 0x00, sizeof(chg_before3.arr) );
        chg_before3.len = 0;
        memset( chg_before4.arr, 0x00, sizeof(chg_before4.arr) );
        chg_before4.len = 0;

		G_POSITION = __LINE__;
        EXEC SQL SELECT RTRIM(変更前1),
                        RTRIM(変更前2),
                        RTRIM(変更前3),
                        RTRIM(変更前4)
                   INTO :chg_before1:ind_chg_before1,
                        :chg_before2:ind_chg_before2,
                        :chg_before3:ind_chg_before3,
                        :chg_before4:ind_chg_before4
                   FROM TD_属性変更情報
                  WHERE 属性ID = '0014'
                    AND CIFNO  = :TMKZs_cifno;
        if( sqlca.sqlcode != 0 && sqlca.sqlcode != ORA_NOF ) {
            sprintf( g_szDtlMsg, "TD_属性変更情報テーブルの検索に失敗しました。(sqlca.sqlcode=%d)", sqlca.sqlcode );
            send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			send_err ( m$sql_statment, sqlca.sqlcode, "SELECT TD_属性変更情報(連絡先住所)", NULL, NULL, G_STATION);
            return( ERROR );
        }
        else if (sqlca.sqlcode == 0){
            /* 変更前：郵便番号＋都道府県市区町村＋大字通称字丁目＋番地気付 */
            memset( chg_address_buff, 0x00, sizeof(chg_address_buff) );

            if( ind_chg_before1 != ORA_NULL ) {
                strncpy( chg_address_buff, chg_before1.arr, chg_before1.len );
            }
            if( ind_chg_before2 != ORA_NULL ) {
                strncat( chg_address_buff, chg_before2.arr, chg_before2.len );
            }
            if( ind_chg_before3 != ORA_NULL ) {
                strncat( chg_address_buff, chg_before3.arr, chg_before3.len );
            }
            if( ind_chg_before4 != ORA_NULL ) {
                strncat( chg_address_buff, chg_before4.arr, chg_before4.len );
            }

            /* ホスト：郵便番号＋都道府県＋市区町村＋大字通称＋字丁目＋番地＋気付 */
            memset( address_buff, 0x00, sizeof(address_buff) );
            strcpy( address_buff, TMKZs_renrakusaki_zip );
            strncat( address_buff, TMKZs_renrakusaki_adress1.arr, TMKZs_renrakusaki_adress1.len );
            strncat( address_buff, TMKZs_renrakusaki_adress2.arr, TMKZs_renrakusaki_adress2.len );
            strncat( address_buff, TMKZs_renrakusaki_adress3.arr, TMKZs_renrakusaki_adress3.len );
            strncat( address_buff, TMKZs_renrakusaki_adress4.arr, TMKZs_renrakusaki_adress4.len );
            strncat( address_buff, TMKZs_renrakusaki_adress5.arr, TMKZs_renrakusaki_adress5.len );
            strncat( address_buff, TMKZs_renrakusaki_adress6.arr, TMKZs_renrakusaki_adress6.len );

            strCodeChange( chg_address_buff );
            strCodeChange( address_buff );

            /* 変更前とHOSTが異なる→HOSTの値で更新 */
            if ( strcmp( chg_address_buff, address_buff ) != 0 ) {
                /* 変更フラグクリア */
                strcpy(TMKZs_renrakusaki_addressflg, " ");
                TMKZsi_renrakusaki_addressflg = ORA_NOT_NULL;

                /* 属性変更あり */
                if ( (*attribute_flag) == 1 ){
                    strcat( sqlcmd_del, ", " );
                }
                else {
                    (*attribute_flag) = 1;
                }
                /* TD_属性変更情報から削除 */
                strcat( sqlcmd_del, "'0014'" );

            }
            else {
                /* 更新なし */
                memcpy( &TMKZs_renrakusaki_hojo_jyusyo, &renraku_address_sub, sizeof(TMKZs_renrakusaki_hojo_jyusyo) );
                TMKZsi_renrakusaki_hojo_jyusyo = ind_renraku_address_sub;
                memcpy( &TMKZs_renrakusaki_adress, &renraku_address, sizeof(TMKZs_renrakusaki_adress) );
                TMKZsi_renrakusaki_adress = ind_renraku_address;
                memcpy( &TMKZs_renrakusaki_adress1, &renraku_address1, sizeof(TMKZs_renrakusaki_adress1) );
                TMKZsi_renrakusaki_adress1 = ind_renraku_address1;
                memcpy( &TMKZs_renrakusaki_adress2, &renraku_address2, sizeof(TMKZs_renrakusaki_adress2) );
                TMKZsi_renrakusaki_adress2 = ind_renraku_address2;
                memcpy( &TMKZs_renrakusaki_adress3, &renraku_address3, sizeof(TMKZs_renrakusaki_adress3) );
                TMKZsi_renrakusaki_adress3 = ind_renraku_address3;
                memcpy( &TMKZs_renrakusaki_adress4, &renraku_address4, sizeof(TMKZs_renrakusaki_adress4) );
                TMKZsi_renrakusaki_adress4 = ind_renraku_address4;
                memcpy( &TMKZs_renrakusaki_adress5, &renraku_address5, sizeof(TMKZs_renrakusaki_adress5) );
                TMKZsi_renrakusaki_adress5 = ind_renraku_address5;
                memcpy( &TMKZs_renrakusaki_adress6, &renraku_address6, sizeof(TMKZs_renrakusaki_adress6) );
                TMKZsi_renrakusaki_adress6 = ind_renraku_address6;

                /* 更新なしの場合、住所コード・郵便番号を元の値で更新 */
                memcpy( TMKZs_renrakusaki_zip_cd, renraku_address_code, sizeof(TMKZs_renrakusaki_zip_cd) );
                TMKZsi_renrakusaki_zip_cd = ind_renraku_address_code;
                memcpy( TMKZs_renrakusaki_zip, renraku_address_no, sizeof(TMKZs_renrakusaki_zip) );
                TMKZsi_renrakusaki_zip = ind_renraku_address_no;
            }
        }
    }

    /* ---------------------------- */
    /* 連絡先住所カナの更新チェック */
    /* ---------------------------- */
    if ( TMKZs_renrakusaki_address_kana_flg[0] == '*' ) {
        memset( chg_before1.arr, 0x00, sizeof(chg_before1.arr) );
        chg_before1.len = 0;
        memset( chg_before2.arr, 0x00, sizeof(chg_before2.arr) );
        chg_before2.len = 0;
        memset( chg_before3.arr, 0x00, sizeof(chg_before3.arr) );
        chg_before3.len = 0;
        memset( chg_before4.arr, 0x00, sizeof(chg_before4.arr) );
        chg_before4.len = 0;

		G_POSITION = __LINE__;
        EXEC SQL SELECT RTRIM(変更前1),
                        RTRIM(変更前2),
                        RTRIM(変更前3),
                        RTRIM(変更前4)
                   INTO :chg_before1:ind_chg_before1,
                        :chg_before2:ind_chg_before2,
                        :chg_before3:ind_chg_before3,
                        :chg_before4:ind_chg_before4
                   FROM TD_属性変更情報
                  WHERE 属性ID = '0015'
                    AND CIFNO  = :TMKZs_cifno;
        if( sqlca.sqlcode != 0 && sqlca.sqlcode != ORA_NOF ) {
            sprintf( g_szDtlMsg, "TD_属性変更情報テーブルの検索に失敗しました。(sqlca.sqlcode=%d)", sqlca.sqlcode );
            send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			send_err ( m$sql_statment, sqlca.sqlcode, "SELECT TD_属性変更情報(連絡先住所カナ)", NULL, NULL, G_STATION);
            return( ERROR );
        }
        else if (sqlca.sqlcode == 0){
            /* 変更前：都道府県市区町村＋大字通称字丁目＋番地気付 */
            memset( chg_address_buff, 0x00, sizeof(chg_address_buff) );

            if( ind_chg_before1 != ORA_NULL ) {
                strncpy( chg_address_buff, chg_before1.arr, chg_before1.len );
            }
            if( ind_chg_before2 != ORA_NULL ) {
                strncat( chg_address_buff, chg_before2.arr, chg_before2.len );
            }
            if( ind_chg_before3 != ORA_NULL ) {
                strncat( chg_address_buff, chg_before3.arr, chg_before3.len );
            }
            if( ind_chg_before4 != ORA_NULL ) {
                strncat( chg_address_buff, chg_before4.arr, chg_before4.len );
            }

            /* ホスト：都道府県＋市区町村＋大字通称＋字丁目＋番地＋気付 */
            memset( address_buff, 0x00, sizeof(address_buff) );
            strncat( address_buff, TMKZs_renrakusaki_adress_kana1.arr, TMKZs_renrakusaki_adress_kana1.len );
            strncat( address_buff, TMKZs_renrakusaki_adress_kana2.arr, TMKZs_renrakusaki_adress_kana2.len );
            strncat( address_buff, TMKZs_renrakusaki_adress_kana3.arr, TMKZs_renrakusaki_adress_kana3.len );
            strncat( address_buff, TMKZs_renrakusaki_adress_kana4.arr, TMKZs_renrakusaki_adress_kana4.len );
            strncat( address_buff, TMKZs_renrakusaki_adress_kana5.arr, TMKZs_renrakusaki_adress_kana5.len );
            strncat( address_buff, TMKZs_renrakusaki_adress_kana6.arr, TMKZs_renrakusaki_adress_kana6.len );

            /* 変更前とHOSTが異なる→HOSTの値で更新 */
            if ( strcmp( chg_address_buff, address_buff ) != 0 ) {
                /* 変更フラグクリア */
                strcpy(TMKZs_renrakusaki_address_kana_flg, " ");
                TMKZsi_renrakusaki_address_kana_flg = ORA_NOT_NULL;

                /* 属性変更あり */
                if ( (*attribute_flag) == 1 ){
                    strcat( sqlcmd_del, ", " );
                }
                else {
                    (*attribute_flag) = 1;
                }
                /* TD_属性変更情報から削除 */
                strcat( sqlcmd_del, "'0015'" );

            }
            else {
                /* 更新なし */
                memcpy( &TMKZs_renrakusaki_hojo_jyusyo_kana, &renraku_address_sub_kana, sizeof(TMKZs_renrakusaki_hojo_jyusyo_kana) );
                TMKZsi_renrakusaki_hojo_jyusyo_kana = ind_renraku_address_sub_kana;
                memcpy( &TMKZs_renrakusaki_adress_kana, &renraku_address_kana, sizeof(TMKZs_renrakusaki_adress_kana) );
                TMKZsi_renrakusaki_adress_kana = ind_renraku_address_kana;
                memcpy( &TMKZs_renrakusaki_adress_kana1, &renraku_address_kana1, sizeof(TMKZs_renrakusaki_adress_kana1) );
                TMKZsi_renrakusaki_adress_kana1 = ind_renraku_address_kana1;
                memcpy( &TMKZs_renrakusaki_adress_kana2, &renraku_address_kana2, sizeof(TMKZs_renrakusaki_adress_kana2) );
                TMKZsi_renrakusaki_adress_kana2 = ind_renraku_address_kana2;
                memcpy( &TMKZs_renrakusaki_adress_kana3, &renraku_address_kana3, sizeof(TMKZs_renrakusaki_adress_kana3) );
                TMKZsi_renrakusaki_adress_kana3 = ind_renraku_address_kana3;
                memcpy( &TMKZs_renrakusaki_adress_kana4, &renraku_address_kana4, sizeof(TMKZs_renrakusaki_adress_kana4) );
                TMKZsi_renrakusaki_adress_kana4 = ind_renraku_address_kana4;
                memcpy( &TMKZs_renrakusaki_adress_kana5, &renraku_address_kana5, sizeof(TMKZs_renrakusaki_adress_kana5) );
                TMKZsi_renrakusaki_adress_kana5 = ind_renraku_address_kana5;
                memcpy( &TMKZs_renrakusaki_adress_kana6, &renraku_address_kana6, sizeof(TMKZs_renrakusaki_adress_kana6) );
                TMKZsi_renrakusaki_adress_kana6 = ind_renraku_address_kana6;
            }
        }
    }


    /* -------------------------------- */
    /* 日中連絡先電話番号の更新チェック */
    /* -------------------------------- */
    if ( TMKZs_nicchu_tel_flg[0] == '*' ) {
        memset( batch_chg_before.arr, 0x00, sizeof(batch_chg_before.arr) );

		G_POSITION = __LINE__;
        EXEC SQL SELECT バッチ用変更前 INTO :batch_chg_before:ind_batch_chg_before
                   FROM TD_属性変更情報
                  WHERE 属性ID = '0016'
                    AND CIFNO  = :TMKZs_cifno;
        if( sqlca.sqlcode != 0 && sqlca.sqlcode != ORA_NOF ) {
            sprintf( g_szDtlMsg, "TD_属性変更情報テーブルの検索に失敗しました。(sqlca.sqlcode=%d)", sqlca.sqlcode );
            send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
			send_err ( m$sql_statment, sqlca.sqlcode, "SELECT TD_属性変更情報(日中連絡先電話番号)", NULL, NULL, G_STATION);
            return( ERROR );
        }
        else if (sqlca.sqlcode == 0){
            if( ind_batch_chg_before != ORA_NULL ) {
                batch_chg_before.arr[batch_chg_before.len]=0x00;
            }
            else {
                memset( batch_chg_before.arr, 0x00, sizeof(batch_chg_before.arr) );
            }

            /* 変更前とHOSTが異なる→HOSTの値で更新 */
            if ( strcmp( batch_chg_before.arr, TMKZs_nicchu_tel ) != 0 ) {
                /* 変更フラグクリア */
                strcpy(TMKZs_nicchu_tel_flg, " ");
                TMKZsi_nicchu_tel_flg = ORA_NOT_NULL;

                /* 属性変更あり */
                if ( (*attribute_flag) == 1 ){
                    strcat( sqlcmd_del, ", " );
                }
                else {
                    (*attribute_flag) = 1;
                }
                /* TD_属性変更情報から削除 */
                strcat( sqlcmd_del, "'0016'" );
            }
            else {

                /* 更新なし */
				/* %02 現行不具合 日中連絡先電話番号の場合もTF_顧客属性を更新する */
				/*	TMKZsi_nicchu_tel=ORA_NULL; */

				/* 更新なし %02 */

                memcpy( TMKZs_nicchu_tel, nicchu_tel, sizeof(TMKZs_nicchu_tel) );
				rtrim( TMKZs_nicchu_tel );  
                TMKZsi_nicchu_tel = ind_renraku_tel;
				
            }
        }
    }

    strcat( sqlcmd_del, ")" );

    return(NORMAL);

}


/*****************************************************************************/
/* Function Name:                                                            */
/*          int deleteTables( g_szDtlMsg )                                   */
/* Made by:                                                                  */
/* Description : テーブルの削除                                              */
/* Arguments:                                                                */
/*   Name          Type/Length  I/O    Content                               */
/* --------------  -----------  ---  -----------------------------------     */
/* g_szDtlMsg       char*        I/O  事象詳細文字列                         */
/*                                                                           */
/* Files :                                                                   */
/*    None                                                                   */
/* Tables:                                                                   */
/*    None                                                                   */
/* Return Code:                                                              */
/*    NORMAL       : 正常終了                                                */
/*    ERROR        : 削除エラー                                              */
/*                                                                           */
/*****************************************************************************/
/* Process Description:                                                      */
/*                                                                           */
/* Considerations:                                                           */
/*                                                                           */
/* Control Flow:                                                             */
/*                                                                           */
/*****************************************************************************/
static int deleteTables( char *g_szDtlMsg )
{

    /* TF_顧客属性テーブルの削除 */
	G_POSITION = __LINE__;
    EXEC SQL DELETE FROM TF_顧客属性
        WHERE 
             CIFNO = :TMKZs_cifno;
    if (sqlca.sqlcode != 0){
        sprintf( g_szDtlMsg, 
                 "TF_顧客属性テーブルの削除に失敗しました。(sqlca.sqlcode=%d)",
                 sqlca.sqlcode );
        send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
		send_err ( m$sql_statment, sqlca.sqlcode, "DELETE FROM TF_顧客属性", NULL, NULL, G_STATION);
        return ERROR;
    }

    /* TD_属性変更情報テーブルの削除 */
	G_POSITION = __LINE__;
    EXEC SQL DELETE FROM TD_属性変更情報
        WHERE 
             CIFNO = :TMKZs_cifno;
    if (sqlca.sqlcode != 0 && sqlca.sqlcode != ORA_NOF){
        sprintf( g_szDtlMsg, 
                 "TD_属性変更情報テーブルの削除に失敗しました。(sqlca.sqlcode=%d)",
                 sqlca.sqlcode );
        send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
		send_err ( m$sql_statment, sqlca.sqlcode, "DELETE FROM TD_属性変更情報", NULL, NULL, G_STATION);
        return ERROR;
    }

    return NORMAL;
}


/*****************************************************************************/
/* Function Name:                                                            */
/*     putAcctLogFile(int tp, RECV_FILE_DATA *pData, COUNT *dCount, int rc,  */
/*                                                        char *g_szDtlMsg ) */
/* Made by:                                                                  */
/* Description : ログファイル出力                                            */
/* Arguments:                                                                */
/*   Name          Type/Length  I/O    Content                               */
/* --------------  -----------  ---  -----------------------------------     */
/* tp                int         I    ログタイプ識別                         */
/* RECV_FILE_DATA    *pData      I    更新対象レコード情報を格納している     */
/* COUNT             *dCount     I    処理件数を格納している                 */
/* rc                int         I    処理結果を格納している                 */
/* g_szDtlMsg       char*        I/O  事象詳細文字列                         */
/*                                                                           */
/* Files :                                                                   */
/*    None                                                                   */
/* Tables:                                                                   */
/*    None                                                                   */
/* Return Code:                                                              */
/*    NORMAL: 正常                                                           */
/*    ERROR : ファイルアクセスエラー                                         */
/*                                                                           */
/*****************************************************************************/
/* Process Description:                                                      */
/*                                                                           */
/* Considerations:                                                           */
/*                                                                           */
/* Control Flow:                                                             */
/*                                                                           */
/*****************************************************************************/
static int putAcctLogFile(int tp, RECV_FILE_DATA *pData, COUNT *dCount, int rc,
                          char *g_szDtlMsg )
{
    AP_D_BTLOG log;
    char    szTime[EMB_C_DTIME_LEN + 1];
    time_t  t = time( NULL );

    /* バッファ初期化 */
    memset( &log, ' ', sizeof(log));
    log.szDelimit[0] = 0x0a;
    log.szDelimit1[0] = 0X0a;

    if (tp == L_WRITE_END){
        sprintf( log.szNote, 
                 "[ RECORD COUNT:%d <OK>:%d (INS:%d UPD:%d DEL:%d ) <NG>:%d ]",
                 dCount->iRecNum,                    /* 処理件数             */
                 dCount->iOkNum,                     /* 正常終了             */
                 dCount->iInsNum,                    /* 正常終了（新規登録） */
                 dCount->iUpdNum,                    /* 正常終了（更新）     */
                 dCount->iDelNum,                    /* 正常終了（削除）     */
                 dCount->iNgNum );					 /* ERROR終了            */

		sprintf ( g_szDtlMsg,
				"[ RECORD COUNT:%d <OK>:%d (INS:%d UPD:%d DEL:%d ) <NG>:%d ]",
                 dCount->iRecNum,                    /* 処理件数             */
                 dCount->iOkNum,                     /* 正常終了             */
                 dCount->iInsNum,                    /* 正常終了（新規登録） */
                 dCount->iUpdNum,                    /* 正常終了（更新）     */
                 dCount->iDelNum,                    /* 正常終了（削除）     */
                 dCount->iNgNum );					 /* ERROR終了            */

		send_err (  m$message1, NORMAL, g_szDtlMsg, NULL , NULL, G_STATION);

        /* 処理結果ファイルへの書き込み */
        if ( fwrite( &log, sizeof(AP_D_BTLOG) - sizeof(log.szNote1) - sizeof(log.szDelimit1),
                     1, g_pfLogFile ) != 1 ) {
			send_err ( m$file_write, errno, g_szLogFile, log , NULL, G_STATION);

            return ERROR;
        }

    }else{
        /* 現状NORMAL正常時は処理しない。（以下に処理だけは残しておく）*/
        if ( rc == NORMAL ) return NORMAL;

        /* リターンコード編集 */
        switch( rc ) {
            case NORMAL:
                memcpy( log.szRtInfo, "NORMAL",       6); /* 正常終了                  */
                break;
            case ERROR:
                memcpy( log.szRtInfo, "ERROR",        5); /* エラー既にデータあり      */
                break;
            default:
                memcpy( log.szRtInfo, "NONE",         4); /* その他                    */
                break;
        }

        if (rc != NORMAL){
            memcpy( log.szRtType, " NG ", 4); /* エラー表示    */
        }
        else{
            memcpy( log.szRtType, " OK ", 4); /* 正常終了表示  */
        }
        /* 日時 */
        strftime( szTime, EMB_C_DTIME_LEN + 1, "%Y-%m-%d %H:%M:%S", localtime( &t ));
        memcpy( log.szDateTime,szTime, EMB_C_DTIME_LEN );

        /* 備考(顧客属性差分ファイルの処理データ表示） */
        sprintf( log.szNote, "[ dataDATA ]%.*s,%.*s,%.*s,%.*s",
             sizeof(pData->record_id), pData->record_id,
             sizeof(pData->change_id), pData->change_id,
             sizeof(pData->cifno), pData->cifno,
             sizeof(pData->data_date), pData->data_date
        );

        /* 事象発生詳細レコード番号、事象詳細文字列 */
        sprintf( log.szNote1, "(%d) %.*s", dCount->iRecNum,
                                           (unsigned int)strlen(g_szDtlMsg), g_szDtlMsg );

        /* 処理結果ログファイルへの書き込み */
        if ( fwrite( &log, sizeof(AP_D_BTLOG), 1, g_pfLogFile ) != 1 ){
			send_err ( m$file_write, errno, g_szLogFile, log , NULL, G_STATION);
            return ERROR;
        }
    }

    return NORMAL;
}


/*****************************************************************************/
/* Function Name:                                                            */
/*   static int commit( VOID )                                               */
/*                                                                           */
/* Description:                                                              */
/*   ＤＢのコミット                                                          */
/*                                                                           */
/* Arguments:                                                                */
/*   Name          Type/Length  I/O    Content                               */
/* --------------  -----------  ---  -----------------------------------     */
/*   None                                                                    */
/*                                                                           */
/* Files:                                                                    */
/*   None                                                                    */
/*                                                                           */
/* Tables:                                                                   */
/*   None                                                                    */
/*                                                                           */
/* Return Code:                                                              */
/*   NORMAL         : 正常終了                                               */
/*   EMUSC_ERR_SYSTEM : ＤＢコミット失敗                                     */
/*                                                                           */
/*****************************************************************************/
/* Process Description:                                                      */
/*   1. DBのコミットを実施する                                               */
/*                                                                           */
/* Considerations:                                                           */
/*   1. 下記のグローバル変数でエラーメッセージを設定する                     */
/*      ・g_szDtlMsg                                                         */
/*                                                                           */
/* Control Flow:                                                             */
/*                                                                           */
/*****************************************************************************/
static int commit( VOID )
{

    /* ＤＢのコミット */
    EXEC SQL COMMIT;
    if (sqlca.sqlcode < 0) {
        sprintf(g_szDtlMsg,
                "ＤＢのコミットに失敗しました。(CODE=%ld)",
                sqlca.sqlcode);
        send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
        return ERROR;
    }


    return NORMAL;
}


/*****************************************************************************/
/* Function Name:                                                            */
/*     finalize( int rc, int iRecNum, int iOkNum )                           */
/* Made by:                                                                  */
/* Description:終了処理                                                      */
/* Arguments:                                                                */
/*   Name          Type/Length  I/O    Content                               */
/* --------------  -----------  ---  -----------------------------------     */
/* rc              int           i   リターンコード                          */
/* iRecNum         int           i   入力件数                                */
/* iOkNum          int           i   成功件数                                */
/*                                                                           */
/* Files :                                                                   */
/*    None                                                                   */
/* Tables:                                                                   */
/*    None                                                                   */
/* Return Code:                                                              */
/*                                                                           */
/*****************************************************************************/
/* Process Description:                                                      */
/*                                                                           */
/* Considerations:                                                           */
/*                                                                           */
/* Control Flow:                                                             */
/*                                                                           */
/*****************************************************************************/
static void finalize( int rc, int iRecNum, int iOkNum )
{

    /* ファイルのクローズ */
	if ( file_open_flag1 == 1 ) {
		fclose( g_pfRecvFile );
	}
	if ( file_open_flag2 == 1 ) {
		fclose( g_pfLogFile );
	}

    /* ＤＢ接続解除 */
   /* EXEC SQL CONNECT RESET;*/
	/*
    if ( sqlca.sqlcode != 0 ){
        send_err( LOG_C_TYPERR, 
            "ＤＢ接続の解除が失敗しました。(sqlca.sqlcode=%d)", sqlca.sqlcode );
    }

    send_err( LOG_C_TYPINF,
                       "プロセス(tf_kokyaku_u)を終了します。(終了コード=%d 処理件数=%d/%d)",
                       rc, iOkNum, iRecNum );

   	*/

	exit ( rc );

}


/*****************************************************************************/
/* Function Name :                                                           */
/*            void strCodeChange ( void )                                    */
/* Made by :                                                                 */
/* Description : 対象文字のコード変換                                        */
/* Arguments :                                                               */
/*   Name          Type/Length  I/O    Content                               */
/* --------------  -----------  ---  -----------------------------------     */
/*    strReturn      *char       O   リターン文字列                          */
/* Files : None                                                              */
/* Tables : None                                                             */
/* Return Code : None                                                        */
/*****************************************************************************/
/* Process Description :                                                     */
/* Considerations :                                                          */
/* Control Flow :                                                            */
/*****************************************************************************/
static void strCodeChange ( char *strReturn ){
    /* 変更前の文字                      T                   U                   V                   W                   X                   Y                   Z                   [                   \                   ]                                                          */
    unsigned char strBefore[13][2+1] = { 0xFA , 0x4A , 0x00 , 0xFA , 0x4B , 0x00 , 0xFA , 0x4C , 0x00 , 0xFA , 0x4D , 0x00 , 0xFA , 0x4E , 0x00 , 0xFA , 0x4F , 0x00 , 0xFA , 0x50 , 0x00 , 0xFA , 0x51 , 0x00 , 0xFA , 0x52 , 0x00 , 0xFA , 0x53 , 0x00 , 0xFA , 0x59 , 0x00 , 0xFA , 0x5A , 0x00 , 0xFA , 0x58 , 0x00 };
    /* 変更後の文字                      T                   U                   V                   W                   X                   Y                   Z                   [                   \                   ]                                                          */
    unsigned char strAfter[13][2+1]  = { 0x87 , 0x54 , 0x00 , 0x87 , 0x55 , 0x00 , 0x87 , 0x56 , 0x00 , 0x87 , 0x57 , 0x00 , 0x87 , 0x58 , 0x00 , 0x87 , 0x59 , 0x00 , 0x87 , 0x5A , 0x00 , 0x87 , 0x5B , 0x00 , 0x87 , 0x5C , 0x00 , 0x87 , 0x5D , 0x00 , 0x87 , 0x82 , 0x00 , 0x87 , 0x84 , 0x00 , 0x87 , 0x8A , 0x00 };
    char strB[2+1];
    char strA[2+1];
    char strChange[1024];
    int i;
    int intBeforeLen;
    char *strPointer;
    
    memset( strB, 0x00, sizeof(strB) );
    memset( strA, 0x00, sizeof(strA) );
    memset( strChange, 0x00, sizeof(strChange) );
    
    strcpy( strChange, strReturn );
    /* 変更対象の文字コード数を取得 */
    intBeforeLen = sizeof(strBefore) / sizeof(strBefore[0]);
    
    for (i = 0; i < intBeforeLen; i++) {
        strcpy(strB ,strBefore[i]);
        strcpy(strA ,strAfter[i]);
        /* 見つからなくなるまで繰り返す */
        while ((strPointer = strstr(strChange, strB)) != NULL) {
            /* 対象文字を置き換える */
            memcpy(strPointer, strA, 2);
        }
    }
    /* 戻り値にコピー */
    strcpy( strReturn, strChange );
}

/*****************************************************************************/
/* Function Name:                                                            */
/*     rollback( void )                                                      */
/* Made by:                                                                  */
/* Description:ＤＢのロールバック                                            */
/* Arguments:                                                                */
/*   Name          Type/Length  I/O    Content                               */
/* --------------  -----------  ---  -----------------------------------     */
/*                                                                           */
/* Files :                                                                   */
/*    None                                                                   */
/* Tables:                                                                   */
/*    None                                                                   */
/* Return Code:                                                              */
/*    NORMAL : 正常                                                          */
/*    ERROR  : ロールバックエラー（システムエラー）                          */
/*                                                                           */
/*****************************************************************************/
/* Process Description:                                                      */
/*                                                                           */
/* Considerations:                                                           */
/*                                                                           */
/* Control Flow:                                                             */
/*                                                                           */
/*****************************************************************************/
static int rollback( )
{
    
	/* ＤＢのロールバック */
    EXEC SQL ROLLBACK WORK;
    if (sqlca.sqlcode < 0) {
        sprintf(g_szDtlMsg,
                "ＤＢのロールバックに失敗しました。(CODE=%ld)",
                sqlca.sqlcode);
        send_err ( m$emb_error, -1, g_szDtlMsg, NULL, NULL, G_STATION);
        return ERROR;
    }

    return NORMAL;
}

void dump(i_buf,size,name)
char *i_buf;
int size;
char *name;
{
    char o_buf[1024];

    memset(o_buf,0x00,sizeof(o_buf));
    memcpy(o_buf,i_buf,size);

    printf("%s=[%s]\n",name,o_buf);

}